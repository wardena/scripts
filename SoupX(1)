#This is a script specific to the human dlPFC 73 sample dataset for snRNA-seq. To adjust for your own script you will need to do the individual sample clean up on your own individual samples

install.packages("SoupX")
library(SoupX)
install.packages("hdf5r")
library(hdf5r)

#Sample 1
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1000_GEX_Sample_303")
filt.matrix_1000_GEX_Sample_303<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1000_GEX_Sample_303<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1000_GEX_Sample_303)
str(filt.matrix_1000_GEX_Sample_303)
srat_1000_GEX_Sample_303<-CreateSeuratObject(counts=filt.matrix_1000_GEX_Sample_303)
srat_1000_GEX_Sample_303
soup.channel_1000_GEX_Sample_303<-SoupChannel(raw.matrix_1000_GEX_Sample_303, filt.matrix_1000_GEX_Sample_303)
soup.channel_1000_GEX_Sample_303
srat_1000_GEX_Sample_303 <- NormalizeData(srat_1000_GEX_Sample_303, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1000_GEX_Sample_303 <- FindVariableFeatures(srat_1000_GEX_Sample_303, selection.method = "vst", nfeatures = 2000)
srat_1000_GEX_Sample_303 <- ScaleData(srat_1000_GEX_Sample_303)
srat_1000_GEX_Sample_303 <- RunPCA(srat_1000_GEX_Sample_303, verbose = F)
srat_1000_GEX_Sample_303 <- RunUMAP(srat_1000_GEX_Sample_303, dims = 1:15, verbose = F)
srat_1000_GEX_Sample_303 <- FindNeighbors(srat_1000_GEX_Sample_303, dims = 1:15, verbose = F)
srat_1000_GEX_Sample_303<- FindClusters(srat_1000_GEX_Sample_303, verbose = T)

meta_1000_GEX_Sample_303    <- srat_1000_GEX_Sample_303@meta.data
umap_1000_GEX_Sample_303    <- srat_1000_GEX_Sample_303@reductions$umap@cell.embeddings
soup.channel_1000_GEX_Sample_303  <- setClusters(soup.channel_1000_GEX_Sample_303, setNames(meta_1000_GEX_Sample_303$seurat_clusters, rownames(meta_1000_GEX_Sample_303)))

soup.channel  <- setDR(soup.channel_1000_GEX_Sample_303, umap_1000_GEX_Sample_303)
head(meta_1000_GEX_Sample_303)
soup.channel_1000_GEX_Sample_303 <- autoEstCont(soup.channel_1000_GEX_Sample_303)
head(soup.channel_1000_GEX_Sample_303$soupProfile[order(soup.channel_1000_GEX_Sample_303$soupProfile$est, decreasing = T), ], n = 20)

out_1000_GEX_Sample_303 = adjustCounts(soup.channel_1000_GEX_Sample_303)

#Sample 2
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1002_GEX_Sample_351")
filt.matrix_1002_GEX_Sample_351<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1002_GEX_Sample_351<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1002_GEX_Sample_351)
str(filt.matrix_1002_GEX_Sample_351)
srat_1002_GEX_Sample_351<-CreateSeuratObject(counts=filt.matrix_1002_GEX_Sample_351)
1002_GEX_Sample_351
soup.channel_1002_GEX_Sample_351<-SoupChannel(raw.matrix_1002_GEX_Sample_351, filt.matrix_1002_GEX_Sample_351)
soup.channel_1002_GEX_Sample_351
srat_1002_GEX_Sample_351 <- NormalizeData(srat_1002_GEX_Sample_351, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1002_GEX_Sample_351 <- FindVariableFeatures(srat_1002_GEX_Sample_351, selection.method = "vst", nfeatures = 2000)
srat_1002_GEX_Sample_351 <- ScaleData(srat_1002_GEX_Sample_351)
srat_1002_GEX_Sample_351 <- RunPCA(srat_1002_GEX_Sample_351, verbose = F)
srat_1002_GEX_Sample_351 <- RunUMAP(srat_1002_GEX_Sample_351, dims = 1:15, verbose = F)
srat_1002_GEX_Sample_351 <- FindNeighbors(srat_1002_GEX_Sample_351, dims = 1:15, verbose = F)
srat_1002_GEX_Sample_351 <- FindClusters(srat_1002_GEX_Sample_351, verbose = T)

meta_1002_GEX_Sample_351    <- srat_1002_GEX_Sample_351@meta.data
umap_1002_GEX_Sample_351    <- srat_1002_GEX_Sample_351@reductions$umap@cell.embeddings
soup.channel_1002_GEX_Sample_351  <- setClusters(soup.channel_1002_GEX_Sample_351, setNames(meta_1002_GEX_Sample_351$seurat_clusters, rownames(meta_1002_GEX_Sample_351)))

soup.channel_1002_GEX_Sample_351  <- setDR(soup.channel_1002_GEX_Sample_351, umap_1002_GEX_Sample_351)
head(meta_1002_GEX_Sample_351)
soup.channel_1002_GEX_Sample_351 <- autoEstCont(soup.channel_1002_GEX_Sample_351)
head(soup.channel_1002_GEX_Sample_351$soupProfile[order(soup.channel_1002_GEX_Sample_351$soupProfile$est, decreasing = T), ], n = 20)

out_1002_GEX_Sample_351 = adjustCounts(soup.channel_1002_GEX_Sample_351)

#Sample 3
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1003_GEX_Sample_366")
filt.matrix_1003_GEX_Sample_366<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1003_GEX_Sample_366<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1003_GEX_Sample_366)
str(filt.matrix_1003_GEX_Sample_366)
srat_1003_GEX_Sample_366<-CreateSeuratObject(counts=filt.matrix_1003_GEX_Sample_366)
1003_GEX_Sample_366
soup.channel_1003_GEX_Sample_366<-SoupChannel(raw.matrix_1003_GEX_Sample_366, filt.matrix_1003_GEX_Sample_366)
soup.channel_1003_GEX_Sample_366
srat_1003_GEX_Sample_366 <- NormalizeData(srat_1003_GEX_Sample_366, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1003_GEX_Sample_366 <- FindVariableFeatures(srat_1003_GEX_Sample_366, selection.method = "vst", nfeatures = 2000)
srat_1003_GEX_Sample_366 <- ScaleData(srat_1003_GEX_Sample_366)
srat_1003_GEX_Sample_366 <- RunPCA(srat_1003_GEX_Sample_366, verbose = F)
srat_1003_GEX_Sample_366 <- RunUMAP(srat_1003_GEX_Sample_366, dims = 1:15, verbose = F)
srat_1003_GEX_Sample_366 <- FindNeighbors(srat_1003_GEX_Sample_366, dims = 1:15, verbose = F)
srat_1003_GEX_Sample_366 <- FindClusters(srat_1003_GEX_Sample_366, verbose = T)

meta_1003_GEX_Sample_366    <- srat_1003_GEX_Sample_366@meta.data
umap_1003_GEX_Sample_366    <- srat_1003_GEX_Sample_366@reductions$umap@cell.embeddings
soup.channel_1003_GEX_Sample_366  <- setClusters(soup.channel_1003_GEX_Sample_366, setNames(meta_1003_GEX_Sample_366$seurat_clusters, rownames(meta_1003_GEX_Sample_366)))

soup.channel_1003_GEX_Sample_366  <- setDR(soup.channel_1003_GEX_Sample_366, umap_1003_GEX_Sample_366)
head(meta_1003_GEX_Sample_366)
soup.channel_1003_GEX_Sample_366 <- autoEstCont(soup.channel_1003_GEX_Sample_366)
head(soup.channel_1003_GEX_Sample_366$soupProfile[order(soup.channel_1003_GEX_Sample_366$soupProfile$est, decreasing = T), ], n = 20)

out_1003_GEX_Sample_366 = adjustCounts(soup.channel_1003_GEX_Sample_366)


#Sample 4
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1155_GEX_Sample_586")
filt.matrix_1155_GEX_Sample_586<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1155_GEX_Sample_586<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1155_GEX_Sample_586)
str(filt.matrix_1155_GEX_Sample_586)
srat_1155_GEX_Sample_586<-CreateSeuratObject(counts=filt.matrix_1155_GEX_Sample_586)
1155_GEX_Sample_586
soup.channel_1155_GEX_Sample_586<-SoupChannel(raw.matrix_1155_GEX_Sample_586, filt.matrix_1155_GEX_Sample_586)
soup.channel_1155_GEX_Sample_586
srat_1155_GEX_Sample_586 <- NormalizeData(srat_1155_GEX_Sample_586, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1155_GEX_Sample_586 <- FindVariableFeatures(srat_1155_GEX_Sample_586, selection.method = "vst", nfeatures = 2000)
srat_1155_GEX_Sample_586 <- ScaleData(srat_1155_GEX_Sample_586)
srat_1155_GEX_Sample_586 <- RunPCA(srat_1155_GEX_Sample_586, verbose = F)
srat_1155_GEX_Sample_586 <- RunUMAP(srat_1155_GEX_Sample_586, dims = 1:15, verbose = F)
srat_1155_GEX_Sample_586 <- FindNeighbors(srat_1155_GEX_Sample_586, dims = 1:15, verbose = F)
srat_1155_GEX_Sample_586 <- FindClusters(srat_1155_GEX_Sample_586, verbose = T)

meta_1155_GEX_Sample_586    <- srat_1155_GEX_Sample_586@meta.data
umap_1155_GEX_Sample_586    <- srat_1155_GEX_Sample_586@reductions$umap@cell.embeddings
soup.channel_1155_GEX_Sample_586  <- setClusters(soup.channel_1155_GEX_Sample_586, setNames(meta_1155_GEX_Sample_586$seurat_clusters, rownames(meta_1155_GEX_Sample_586)))

soup.channel_1155_GEX_Sample_586  <- setDR(soup.channel_1155_GEX_Sample_586, umap_1155_GEX_Sample_586)
head(meta_1155_GEX_Sample_586)
soup.channel_1155_GEX_Sample_586 <- autoEstCont(soup.channel_1155_GEX_Sample_586)
head(soup.channel_1155_GEX_Sample_586$soupProfile[order(soup.channel_1155_GEX_Sample_586$soupProfile$est, decreasing = T), ], n = 20)

out_1155_GEX_Sample_586 = adjustCounts(soup.channel_1155_GEX_Sample_586)

#Sample 5
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1156_GEX_Sample_339")
filt.matrix_1156_GEX_Sample_339<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1156_GEX_Sample_339<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1156_GEX_Sample_339)
str(filt.matrix_1156_GEX_Sample_339)
srat_1156_GEX_Sample_339<-CreateSeuratObject(counts=filt.matrix_1156_GEX_Sample_339)
1156_GEX_Sample_339
soup.channel_1156_GEX_Sample_339<-SoupChannel(raw.matrix_1156_GEX_Sample_339, filt.matrix_1156_GEX_Sample_339)
soup.channel_1156_GEX_Sample_339
srat_1156_GEX_Sample_339 <- NormalizeData(srat_1156_GEX_Sample_339, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1156_GEX_Sample_339 <- FindVariableFeatures(srat_1156_GEX_Sample_339, selection.method = "vst", nfeatures = 2000)
srat_1156_GEX_Sample_339 <- ScaleData(srat_1156_GEX_Sample_339)
srat_1156_GEX_Sample_339 <- RunPCA(srat_1156_GEX_Sample_339, verbose = F)
srat_1156_GEX_Sample_339 <- RunUMAP(srat_1156_GEX_Sample_339, dims = 1:15, verbose = F)
srat_1156_GEX_Sample_339 <- FindNeighbors(srat_1156_GEX_Sample_339, dims = 1:15, verbose = F)
srat_1156_GEX_Sample_339 <- FindClusters(srat_1156_GEX_Sample_339, verbose = T)

meta_1156_GEX_Sample_339    <- srat_1156_GEX_Sample_339@meta.data
umap_1156_GEX_Sample_339    <- srat_1156_GEX_Sample_339@reductions$umap@cell.embeddings
soup.channel_1156_GEX_Sample_339  <- setClusters(soup.channel_1156_GEX_Sample_339, setNames(meta_1156_GEX_Sample_339$seurat_clusters, rownames(meta_1156_GEX_Sample_339)))

soup.channel_1156_GEX_Sample_339  <- setDR(soup.channel_1156_GEX_Sample_339, umap_1156_GEX_Sample_339)
head(meta_1156_GEX_Sample_339)
soup.channel_1156_GEX_Sample_339 <- autoEstCont(soup.channel_1156_GEX_Sample_339)
head(soup.channel_1156_GEX_Sample_339$soupProfile[order(soup.channel_1156_GEX_Sample_339$soupProfile$est, decreasing = T), ], n = 20)

out_1156_GEX_Sample_339 = adjustCounts(soup.channel_1156_GEX_Sample_339)

#Sample 6

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1157_GEX_Sample_236")
filt.matrix_1157_GEX_Sample_236<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1157_GEX_Sample_236<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1157_GEX_Sample_236)
str(filt.matrix_1157_GEX_Sample_236)
srat_1157_GEX_Sample_236<-CreateSeuratObject(counts=filt.matrix_1157_GEX_Sample_236)
1157_GEX_Sample_236
soup.channel_1157_GEX_Sample_236<-SoupChannel(raw.matrix_1157_GEX_Sample_236, filt.matrix_1157_GEX_Sample_236)
soup.channel_1157_GEX_Sample_236
srat_1157_GEX_Sample_236 <- NormalizeData(srat_1157_GEX_Sample_236, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1157_GEX_Sample_236 <- FindVariableFeatures(srat_1157_GEX_Sample_236, selection.method = "vst", nfeatures = 2000)
srat_1157_GEX_Sample_236 <- ScaleData(srat_1157_GEX_Sample_236)
srat_1157_GEX_Sample_236 <- RunPCA(srat_1157_GEX_Sample_236, verbose = F)
srat_1157_GEX_Sample_236 <- RunUMAP(srat_1157_GEX_Sample_236, dims = 1:15, verbose = F)
srat_1157_GEX_Sample_236 <- FindNeighbors(srat_1157_GEX_Sample_236, dims = 1:15, verbose = F)
srat_1157_GEX_Sample_236 <- FindClusters(srat_1157_GEX_Sample_236, verbose = T)

meta_1157_GEX_Sample_236    <- srat_1157_GEX_Sample_236@meta.data
umap_1157_GEX_Sample_236    <- srat_1157_GEX_Sample_236@reductions$umap@cell.embeddings
soup.channel_1157_GEX_Sample_236  <- setClusters(soup.channel_1157_GEX_Sample_236, setNames(meta_1157_GEX_Sample_236$seurat_clusters, rownames(meta_1157_GEX_Sample_236)))

soup.channel_1157_GEX_Sample_236  <- setDR(soup.channel_1157_GEX_Sample_236, umap_1157_GEX_Sample_236)
head(meta_1157_GEX_Sample_236)
soup.channel_1157_GEX_Sample_236 <- autoEstCont(soup.channel_1157_GEX_Sample_236)
head(soup.channel_1157_GEX_Sample_236$soupProfile[order(soup.channel_1157_GEX_Sample_236$soupProfile$est, decreasing = T), ], n = 20)

out_1157_GEX_Sample_236 = adjustCounts(soup.channel_1157_GEX_Sample_236)

#Sample 7
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1158_GEX_Sample_278")
filt.matrix_1158_GEX_Sample_278<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1158_GEX_Sample_278<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1158_GEX_Sample_278)
str(filt.matrix_1158_GEX_Sample_278)
srat_1158_GEX_Sample_278<-CreateSeuratObject(counts=filt.matrix_1158_GEX_Sample_278)
1158_GEX_Sample_278
soup.channel_1158_GEX_Sample_278<-SoupChannel(raw.matrix_1158_GEX_Sample_278, filt.matrix_1158_GEX_Sample_278)
soup.channel_1158_GEX_Sample_278
srat_1158_GEX_Sample_278 <- NormalizeData(srat_1158_GEX_Sample_278, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1158_GEX_Sample_278 <- FindVariableFeatures(srat_1158_GEX_Sample_278, selection.method = "vst", nfeatures = 2000)
srat_1158_GEX_Sample_278 <- ScaleData(srat_1158_GEX_Sample_278)
srat_1158_GEX_Sample_278 <- RunPCA(srat_1158_GEX_Sample_278, verbose = F)
srat_1158_GEX_Sample_278 <- RunUMAP(srat_1158_GEX_Sample_278, dims = 1:15, verbose = F)
srat_1158_GEX_Sample_278 <- FindNeighbors(srat_1158_GEX_Sample_278, dims = 1:15, verbose = F)
srat_1158_GEX_Sample_278 <- FindClusters(srat_1158_GEX_Sample_278, verbose = T)

meta_1158_GEX_Sample_278    <- srat_1158_GEX_Sample_278@meta.data
umap_1158_GEX_Sample_278    <- srat_1158_GEX_Sample_278@reductions$umap@cell.embeddings
soup.channel_1158_GEX_Sample_278  <- setClusters(soup.channel_1158_GEX_Sample_278, setNames(meta_1158_GEX_Sample_278$seurat_clusters, rownames(meta_1158_GEX_Sample_278)))

soup.channel_1158_GEX_Sample_278  <- setDR(soup.channel_1158_GEX_Sample_278, umap_1158_GEX_Sample_278)
head(meta_1158_GEX_Sample_278)
soup.channel_1158_GEX_Sample_278 <- autoEstCont(soup.channel_1158_GEX_Sample_278)
head(soup.channel_1158_GEX_Sample_278$soupProfile[order(soup.channel_1158_GEX_Sample_278$soupProfile$est, decreasing = T), ], n = 20)

out_1158_GEX_Sample_278 = adjustCounts(soup.channel_1158_GEX_Sample_278)

#Sample 8
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1159_GEX_Sample_642")
filt.matrix_1159_GEX_Sample_642<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1159_GEX_Sample_642<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1159_GEX_Sample_642)
str(filt.matrix_1159_GEX_Sample_642)
srat_1159_GEX_Sample_642<-CreateSeuratObject(counts=filt.matrix_1159_GEX_Sample_642)
1159_GEX_Sample_642
soup.channel_1159_GEX_Sample_642<-SoupChannel(raw.matrix_1159_GEX_Sample_642, filt.matrix_1159_GEX_Sample_642)
soup.channel_1159_GEX_Sample_642
srat_1159_GEX_Sample_642 <- NormalizeData(srat_1159_GEX_Sample_642, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1159_GEX_Sample_642 <- FindVariableFeatures(srat_1159_GEX_Sample_642, selection.method = "vst", nfeatures = 2000)
srat_1159_GEX_Sample_642 <- ScaleData(srat_1159_GEX_Sample_642)
srat_1159_GEX_Sample_642 <- RunPCA(srat_1159_GEX_Sample_642, verbose = F)
srat_1159_GEX_Sample_642 <- RunUMAP(srat_1159_GEX_Sample_642, dims = 1:15, verbose = F)
srat_1159_GEX_Sample_642 <- FindNeighbors(srat_1159_GEX_Sample_642, dims = 1:15, verbose = F)
srat_1159_GEX_Sample_642 <- FindClusters(srat_1159_GEX_Sample_642, verbose = T)

meta_1159_GEX_Sample_642    <- srat_1159_GEX_Sample_642@meta.data
umap_1159_GEX_Sample_642    <- srat_1159_GEX_Sample_642@reductions$umap@cell.embeddings
soup.channel_1159_GEX_Sample_642  <- setClusters(soup.channel_1159_GEX_Sample_642, setNames(meta_1159_GEX_Sample_642$seurat_clusters, rownames(meta_1159_GEX_Sample_642)))

soup.channel_1159_GEX_Sample_642  <- setDR(soup.channel_1159_GEX_Sample_642, umap_1159_GEX_Sample_642)
head(meta_1159_GEX_Sample_642)
soup.channel_1159_GEX_Sample_642 <- autoEstCont(soup.channel_1159_GEX_Sample_642)
head(soup.channel_1159_GEX_Sample_642$soupProfile[order(soup.channel_1159_GEX_Sample_642$soupProfile$est, decreasing = T), ], n = 20)

out_1159_GEX_Sample_642 = adjustCounts(soup.channel_1159_GEX_Sample_642)

#Sample 9
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1160_GEX_Sample_723")
filt.matrix_1160_GEX_Sample_723<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1160_GEX_Sample_723<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1160_GEX_Sample_723)
str(filt.matrix_1160_GEX_Sample_723)
srat_1160_GEX_Sample_723<-CreateSeuratObject(counts=filt.matrix_1160_GEX_Sample_723)
1160_GEX_Sample_723
soup.channel_1160_GEX_Sample_723<-SoupChannel(raw.matrix_1160_GEX_Sample_723, filt.matrix_1160_GEX_Sample_723)
soup.channel_1160_GEX_Sample_723
srat_1160_GEX_Sample_723 <- NormalizeData(srat_1160_GEX_Sample_723, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1160_GEX_Sample_723 <- FindVariableFeatures(srat_1160_GEX_Sample_723, selection.method = "vst", nfeatures = 2000)
srat_1160_GEX_Sample_723 <- ScaleData(srat_1160_GEX_Sample_723)
srat_1160_GEX_Sample_723 <- RunPCA(srat_1160_GEX_Sample_723, verbose = F)
srat_1160_GEX_Sample_723 <- RunUMAP(srat_1160_GEX_Sample_723, dims = 1:15, verbose = F)
srat_1160_GEX_Sample_723 <- FindNeighbors(srat_1160_GEX_Sample_723, dims = 1:15, verbose = F)
srat_1160_GEX_Sample_723 <- FindClusters(srat_1160_GEX_Sample_723, verbose = T)

meta_1160_GEX_Sample_723    <- srat_1160_GEX_Sample_723@meta.data
umap_1160_GEX_Sample_723    <- srat_1160_GEX_Sample_723@reductions$umap@cell.embeddings
soup.channel_1160_GEX_Sample_723  <- setClusters(soup.channel_1160_GEX_Sample_723, setNames(meta_1160_GEX_Sample_723$seurat_clusters, rownames(meta_1160_GEX_Sample_723)))

soup.channel_1160_GEX_Sample_723  <- setDR(soup.channel_1160_GEX_Sample_723, umap_1160_GEX_Sample_723)
head(meta_1160_GEX_Sample_723)
soup.channel_1160_GEX_Sample_723 <- autoEstCont(soup.channel_1160_GEX_Sample_723)
head(soup.channel_1160_GEX_Sample_723$soupProfile[order(soup.channel_1160_GEX_Sample_723$soupProfile$est, decreasing = T), ], n = 20)

out_1160_GEX_Sample_723 = adjustCounts(soup.channel_1160_GEX_Sample_723)

#Sample 10
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/1161_GEX_Sample_401")
filt.matrix_1161_GEX_Sample_401<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_1161_GEX_Sample_401<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_1161_GEX_Sample_401)
str(filt.matrix_1161_GEX_Sample_401)
srat_1161_GEX_Sample_401<-CreateSeuratObject(counts=filt.matrix_1161_GEX_Sample_401)
1161_GEX_Sample_401
soup.channel_1161_GEX_Sample_401<-SoupChannel(raw.matrix_1161_GEX_Sample_401, filt.matrix_1161_GEX_Sample_401)
soup.channel_1161_GEX_Sample_401
srat_1161_GEX_Sample_401 <- NormalizeData(srat_1161_GEX_Sample_401, normalization.method = "LogNormalize", scale.factor = 10000)

srat_1161_GEX_Sample_401 <- FindVariableFeatures(srat_1161_GEX_Sample_401, selection.method = "vst", nfeatures = 2000)
srat_1161_GEX_Sample_401 <- ScaleData(srat_1161_GEX_Sample_401)
srat_1161_GEX_Sample_401 <- RunPCA(srat_1161_GEX_Sample_401, verbose = F)
srat_1161_GEX_Sample_401 <- RunUMAP(srat_1161_GEX_Sample_401, dims = 1:15, verbose = F)
srat_1161_GEX_Sample_401 <- FindNeighbors(srat_1161_GEX_Sample_401, dims = 1:15, verbose = F)
srat_1161_GEX_Sample_401 <- FindClusters(srat_1161_GEX_Sample_401, verbose = T)

meta_1161_GEX_Sample_401    <- srat_1161_GEX_Sample_401@meta.data
umap_1161_GEX_Sample_401    <- srat_1161_GEX_Sample_401@reductions$umap@cell.embeddings
soup.channel_1161_GEX_Sample_401  <- setClusters(soup.channel_1161_GEX_Sample_401, setNames(meta_1161_GEX_Sample_401$seurat_clusters, rownames(meta_1161_GEX_Sample_401)))

soup.channel_1161_GEX_Sample_401  <- setDR(soup.channel_1161_GEX_Sample_401, umap_1161_GEX_Sample_401)
head(meta_1161_GEX_Sample_401)
soup.channel_1161_GEX_Sample_401 <- autoEstCont(soup.channel_1161_GEX_Sample_401)
head(soup.channel_1161_GEX_Sample_401$soupProfile[order(soup.channel_1161_GEX_Sample_401$soupProfile$est, decreasing = T), ], n = 20)

out_1161_GEX_Sample_401 = adjustCounts(soup.channel_1161_GEX_Sample_401)

#Sample 11

soup.channel_575<-SoupChannel(raw.matrix_575, filt.matrix_575)
soup.channel_575
srat_575 <- NormalizeData(srat_575, normalization.method = "LogNormalize", scale.factor = 10000)

srat_575 <- FindVariableFeatures(srat_575, selection.method = "vst", nfeatures = 2000)
srat_575 <- ScaleData(srat_575)
srat_575 <- RunPCA(srat_575, verbose = F)
srat_575 <- RunUMAP(srat_575, dims = 1:15, verbose = F)
srat_575 <- FindNeighbors(srat_575, dims = 1:15, verbose = F)
srat_575 <- FindClusters(srat_575, verbose = T)

meta_575    <- srat_575@meta.data
umap_575    <- srat_575@reductions$umap@cell.embeddings
soup.channel_575  <- setClusters(soup.channel_575, setNames(meta_575$seurat_clusters, rownames(meta_575)))

soup.channel_575  <- setDR(soup.channel_575, umap_575)
head(meta_575)
soup.channel_575 <- autoEstCont(soup.channel_575)
head(soup.channel_575$soupProfile[order(soup.channel_575$soupProfile$est, decreasing = T), ], n = 20)

out_575 = adjustCounts(soup.channel_575)

#Sample 12

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/893_3GEX_Sample_813_nuclei")
filt.matrix_893_3GEX_Sample_813_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_893_3GEX_Sample_813_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_893_3GEX_Sample_813_nuclei)
str(filt.matrix_893_3GEX_Sample_813_nuclei)
srat_893_3GEX_Sample_813_nuclei<-CreateSeuratObject(counts=filt.matrix_893_3GEX_Sample_813_nuclei)
893_3GEX_Sample_813_nuclei
soup.channel_893_3GEX_Sample_813_nuclei<-SoupChannel(raw.matrix_893_3GEX_Sample_813_nuclei, filt.matrix_893_3GEX_Sample_813_nuclei)
soup.channel_893_3GEX_Sample_813_nuclei
srat_893_3GEX_Sample_813_nuclei <- NormalizeData(srat_893_3GEX_Sample_813_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_893_3GEX_Sample_813_nuclei <- FindVariableFeatures(srat_893_3GEX_Sample_813_nuclei, selection.method = "vst", nfeatures = 2000)
srat_893_3GEX_Sample_813_nuclei <- ScaleData(srat_893_3GEX_Sample_813_nuclei)
srat_893_3GEX_Sample_813_nuclei <- RunPCA(srat_893_3GEX_Sample_813_nuclei, verbose = F)
srat_893_3GEX_Sample_813_nuclei <- RunUMAP(srat_893_3GEX_Sample_813_nuclei, dims = 1:15, verbose = F)
srat_893_3GEX_Sample_813_nuclei <- FindNeighbors(srat_893_3GEX_Sample_813_nuclei, dims = 1:15, verbose = F)
srat_893_3GEX_Sample_813_nuclei <- FindClusters(srat_893_3GEX_Sample_813_nuclei, verbose = T)

meta_893_3GEX_Sample_813_nuclei    <- srat_893_3GEX_Sample_813_nuclei@meta.data
umap_893_3GEX_Sample_813_nuclei    <- srat_893_3GEX_Sample_813_nuclei@reductions$umap@cell.embeddings
soup.channel_893_3GEX_Sample_813_nuclei  <- setClusters(soup.channel_893_3GEX_Sample_813_nuclei, setNames(meta_893_3GEX_Sample_813_nuclei$seurat_clusters, rownames(meta_893_3GEX_Sample_813_nuclei)))

soup.channel_893_3GEX_Sample_813_nuclei  <- setDR(soup.channel_893_3GEX_Sample_813_nuclei, umap_893_3GEX_Sample_813_nuclei)
head(meta_893_3GEX_Sample_813_nuclei)
soup.channel_893_3GEX_Sample_813_nuclei <- autoEstCont(soup.channel_893_3GEX_Sample_813_nuclei)
head(soup.channel_893_3GEX_Sample_813_nuclei$soupProfile[order(soup.channel_893_3GEX_Sample_813_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_893_3GEX_Sample_813_nuclei = adjustCounts(soup.channel_893_3GEX_Sample_813_nuclei)

#Sample 13

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/894_3GEX_Sample_814_nuclei")
filt.matrix_894_3GEX_Sample_814_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_894_3GEX_Sample_814_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_894_3GEX_Sample_814_nuclei)
str(filt.matrix_894_3GEX_Sample_814_nuclei)
srat_894_3GEX_Sample_814_nuclei<-CreateSeuratObject(counts=filt.matrix_894_3GEX_Sample_814_nuclei)
894_3GEX_Sample_814_nuclei
soup.channel_894_3GEX_Sample_814_nuclei<-SoupChannel(raw.matrix_894_3GEX_Sample_814_nuclei, filt.matrix_894_3GEX_Sample_814_nuclei)
soup.channel_894_3GEX_Sample_814_nuclei
srat_894_3GEX_Sample_814_nuclei <- NormalizeData(srat_894_3GEX_Sample_814_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_894_3GEX_Sample_814_nuclei <- FindVariableFeatures(srat_894_3GEX_Sample_814_nuclei, selection.method = "vst", nfeatures = 2000)
srat_894_3GEX_Sample_814_nuclei <- ScaleData(srat_894_3GEX_Sample_814_nuclei)
srat_894_3GEX_Sample_814_nuclei <- RunPCA(srat_894_3GEX_Sample_814_nuclei, verbose = F)
srat_894_3GEX_Sample_814_nuclei <- RunUMAP(srat_894_3GEX_Sample_814_nuclei, dims = 1:15, verbose = F)
srat_894_3GEX_Sample_814_nuclei <- FindNeighbors(srat_894_3GEX_Sample_814_nuclei, dims = 1:15, verbose = F)
srat_894_3GEX_Sample_814_nuclei <- FindClusters(srat_894_3GEX_Sample_814_nuclei, verbose = T)

meta_894_3GEX_Sample_814_nuclei    <- srat_894_3GEX_Sample_814_nuclei@meta.data
umap_894_3GEX_Sample_814_nuclei    <- srat_894_3GEX_Sample_814_nuclei@reductions$umap@cell.embeddings
soup.channel_894_3GEX_Sample_814_nuclei  <- setClusters(soup.channel_894_3GEX_Sample_814_nuclei, setNames(meta_894_3GEX_Sample_814_nuclei$seurat_clusters, rownames(meta_894_3GEX_Sample_814_nuclei)))

soup.channel_894_3GEX_Sample_814_nuclei  <- setDR(soup.channel_894_3GEX_Sample_814_nuclei, umap_894_3GEX_Sample_814_nuclei)
head(meta_894_3GEX_Sample_814_nuclei)
soup.channel_894_3GEX_Sample_814_nuclei <- autoEstCont(soup.channel_894_3GEX_Sample_814_nuclei)
head(soup.channel_894_3GEX_Sample_814_nuclei$soupProfile[order(soup.channel_894_3GEX_Sample_814_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_894_3GEX_Sample_814_nuclei = adjustCounts(soup.channel_894_3GEX_Sample_814_nuclei)

#Sample 14
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/895_3GEX_Sample_821_nuclei")
filt.matrix_895_3GEX_Sample_821_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_895_3GEX_Sample_821_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_895_3GEX_Sample_821_nuclei)
str(filt.matrix_895_3GEX_Sample_821_nuclei)
srat_895_3GEX_Sample_821_nuclei<-CreateSeuratObject(counts=filt.matrix_895_3GEX_Sample_821_nuclei)
895_3GEX_Sample_821_nuclei
soup.channel_895_3GEX_Sample_821_nuclei<-SoupChannel(raw.matrix_895_3GEX_Sample_821_nuclei, filt.matrix_895_3GEX_Sample_821_nuclei)
soup.channel_895_3GEX_Sample_821_nuclei
srat_895_3GEX_Sample_821_nuclei <- NormalizeData(srat_895_3GEX_Sample_821_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_895_3GEX_Sample_821_nuclei <- FindVariableFeatures(srat_895_3GEX_Sample_821_nuclei, selection.method = "vst", nfeatures = 2000)
srat_895_3GEX_Sample_821_nuclei <- ScaleData(srat_895_3GEX_Sample_821_nuclei)
srat_895_3GEX_Sample_821_nuclei <- RunPCA(srat_895_3GEX_Sample_821_nuclei, verbose = F)
srat_895_3GEX_Sample_821_nuclei <- RunUMAP(srat_895_3GEX_Sample_821_nuclei, dims = 1:15, verbose = F)
srat_895_3GEX_Sample_821_nuclei <- FindNeighbors(srat_895_3GEX_Sample_821_nuclei, dims = 1:15, verbose = F)
srat_895_3GEX_Sample_821_nuclei <- FindClusters(srat_895_3GEX_Sample_821_nuclei, verbose = T)

meta_895_3GEX_Sample_821_nuclei    <- srat_895_3GEX_Sample_821_nuclei@meta.data
umap_895_3GEX_Sample_821_nuclei    <- srat_895_3GEX_Sample_821_nuclei@reductions$umap@cell.embeddings
soup.channel_895_3GEX_Sample_821_nuclei  <- setClusters(soup.channel_895_3GEX_Sample_821_nuclei, setNames(meta_895_3GEX_Sample_821_nuclei$seurat_clusters, rownames(meta_895_3GEX_Sample_821_nuclei)))

soup.channel_895_3GEX_Sample_821_nuclei  <- setDR(soup.channel_895_3GEX_Sample_821_nuclei, umap_895_3GEX_Sample_821_nuclei)
head(meta_895_3GEX_Sample_821_nuclei)
soup.channel_895_3GEX_Sample_821_nuclei <- autoEstCont(soup.channel_895_3GEX_Sample_821_nuclei)
head(soup.channel_895_3GEX_Sample_821_nuclei$soupProfile[order(soup.channel_895_3GEX_Sample_821_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_895_3GEX_Sample_821_nuclei = adjustCounts(soup.channel_895_3GEX_Sample_821_nuclei)

#Sample 15

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/896_3GEX_Sample_825_nuclei")
filt.matrix_896_3GEX_Sample_825_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_896_3GEX_Sample_825_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_896_3GEX_Sample_825_nuclei)
str(filt.matrix_896_3GEX_Sample_825_nuclei)
srat_896_3GEX_Sample_825_nuclei<-CreateSeuratObject(counts=filt.matrix_896_3GEX_Sample_825_nuclei)
896_3GEX_Sample_825_nuclei
soup.channel_896_3GEX_Sample_825_nuclei<-SoupChannel(raw.matrix_896_3GEX_Sample_825_nuclei, filt.matrix_896_3GEX_Sample_825_nuclei)
soup.channel_896_3GEX_Sample_825_nuclei
srat_896_3GEX_Sample_825_nuclei <- NormalizeData(srat_896_3GEX_Sample_825_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_896_3GEX_Sample_825_nuclei <- FindVariableFeatures(srat_896_3GEX_Sample_825_nuclei, selection.method = "vst", nfeatures = 2000)
srat_896_3GEX_Sample_825_nuclei <- ScaleData(srat_896_3GEX_Sample_825_nuclei)
srat_896_3GEX_Sample_825_nuclei <- RunPCA(srat_896_3GEX_Sample_825_nuclei, verbose = F)
srat_896_3GEX_Sample_825_nuclei <- RunUMAP(srat_896_3GEX_Sample_825_nuclei, dims = 1:15, verbose = F)
srat_896_3GEX_Sample_825_nuclei <- FindNeighbors(srat_896_3GEX_Sample_825_nuclei, dims = 1:15, verbose = F)
srat_896_3GEX_Sample_825_nuclei <- FindClusters(srat_896_3GEX_Sample_825_nuclei, verbose = T)

meta_896_3GEX_Sample_825_nuclei    <- srat_896_3GEX_Sample_825_nuclei@meta.data
umap_896_3GEX_Sample_825_nuclei    <- srat_896_3GEX_Sample_825_nuclei@reductions$umap@cell.embeddings
soup.channel_896_3GEX_Sample_825_nuclei  <- setClusters(soup.channel_896_3GEX_Sample_825_nuclei, setNames(meta_896_3GEX_Sample_825_nuclei$seurat_clusters, rownames(meta_896_3GEX_Sample_825_nuclei)))

soup.channel_896_3GEX_Sample_825_nuclei  <- setDR(soup.channel_896_3GEX_Sample_825_nuclei, umap_896_3GEX_Sample_825_nuclei)
head(meta_896_3GEX_Sample_825_nuclei)
soup.channel_896_3GEX_Sample_825_nuclei <- autoEstCont(soup.channel_896_3GEX_Sample_825_nuclei)
head(soup.channel_896_3GEX_Sample_825_nuclei$soupProfile[order(soup.channel_896_3GEX_Sample_825_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_896_3GEX_Sample_825_nuclei = adjustCounts(soup.channel_896_3GEX_Sample_825_nuclei)

#Sample 16
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/898_3GEX_Sample_6992_nuclei")
filt.matrix_898_3GEX_Sample_6992_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_898_3GEX_Sample_6992_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_898_3GEX_Sample_6992_nuclei)
str(filt.matrix_898_3GEX_Sample_6992_nuclei)
srat_898_3GEX_Sample_6992_nuclei<-CreateSeuratObject(counts=filt.matrix_898_3GEX_Sample_6992_nuclei)
898_3GEX_Sample_6992_nuclei
soup.channel_898_3GEX_Sample_6992_nuclei<-SoupChannel(raw.matrix_898_3GEX_Sample_6992_nuclei, filt.matrix_898_3GEX_Sample_6992_nuclei)
soup.channel_898_3GEX_Sample_6992_nuclei
srat_898_3GEX_Sample_6992_nuclei <- NormalizeData(srat_898_3GEX_Sample_6992_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_898_3GEX_Sample_6992_nuclei <- FindVariableFeatures(srat_898_3GEX_Sample_6992_nuclei, selection.method = "vst", nfeatures = 2000)
srat_898_3GEX_Sample_6992_nuclei <- ScaleData(srat_898_3GEX_Sample_6992_nuclei)
srat_898_3GEX_Sample_6992_nuclei <- RunPCA(srat_898_3GEX_Sample_6992_nuclei, verbose = F)
srat_898_3GEX_Sample_6992_nuclei <- RunUMAP(srat_898_3GEX_Sample_6992_nuclei, dims = 1:15, verbose = F)
srat_898_3GEX_Sample_6992_nuclei <- FindNeighbors(srat_898_3GEX_Sample_6992_nuclei, dims = 1:15, verbose = F)
srat_898_3GEX_Sample_6992_nuclei <- FindClusters(srat_898_3GEX_Sample_6992_nuclei, verbose = T)

meta_898_3GEX_Sample_6992_nuclei    <- srat_898_3GEX_Sample_6992_nuclei@meta.data
umap_898_3GEX_Sample_6992_nuclei    <- srat_898_3GEX_Sample_6992_nuclei@reductions$umap@cell.embeddings
soup.channel_898_3GEX_Sample_6992_nuclei  <- setClusters(soup.channel_898_3GEX_Sample_6992_nuclei, setNames(meta_898_3GEX_Sample_6992_nuclei$seurat_clusters, rownames(meta_898_3GEX_Sample_6992_nuclei)))

soup.channel_898_3GEX_Sample_6992_nuclei  <- setDR(soup.channel_898_3GEX_Sample_6992_nuclei, umap_898_3GEX_Sample_6992_nuclei)
head(meta_898_3GEX_Sample_6992_nuclei)
soup.channel_898_3GEX_Sample_6992_nuclei <- autoEstCont(soup.channel_898_3GEX_Sample_6992_nuclei)
head(soup.channel_898_3GEX_Sample_6992_nuclei$soupProfile[order(soup.channel_898_3GEX_Sample_6992_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_898_3GEX_Sample_6992_nuclei = adjustCounts(soup.channel_898_3GEX_Sample_6992_nuclei)

#Sample 17
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/899_3GEX_Sample_6996_nuclei")
filt.matrix_899_3GEX_Sample_6996_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_899_3GEX_Sample_6996_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_899_3GEX_Sample_6996_nuclei)
str(filt.matrix_899_3GEX_Sample_6996_nuclei)
srat_899_3GEX_Sample_6996_nuclei<-CreateSeuratObject(counts=filt.matrix_899_3GEX_Sample_6996_nuclei)
899_3GEX_Sample_6996_nuclei
soup.channel_899_3GEX_Sample_6996_nuclei<-SoupChannel(raw.matrix_899_3GEX_Sample_6996_nuclei, filt.matrix_899_3GEX_Sample_6996_nuclei)
soup.channel_899_3GEX_Sample_6996_nuclei
srat_899_3GEX_Sample_6996_nuclei <- NormalizeData(srat_899_3GEX_Sample_6996_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_899_3GEX_Sample_6996_nuclei <- FindVariableFeatures(srat_899_3GEX_Sample_6996_nuclei, selection.method = "vst", nfeatures = 2000)
srat_899_3GEX_Sample_6996_nuclei <- ScaleData(srat_899_3GEX_Sample_6996_nuclei)
srat_899_3GEX_Sample_6996_nuclei <- RunPCA(srat_899_3GEX_Sample_6996_nuclei, verbose = F)
srat_899_3GEX_Sample_6996_nuclei <- RunUMAP(srat_899_3GEX_Sample_6996_nuclei, dims = 1:15, verbose = F)
srat_899_3GEX_Sample_6996_nuclei <- FindNeighbors(srat_899_3GEX_Sample_6996_nuclei, dims = 1:15, verbose = F)
srat_899_3GEX_Sample_6996_nuclei <- FindClusters(srat_899_3GEX_Sample_6996_nuclei, verbose = T)

meta_899_3GEX_Sample_6996_nuclei    <- srat_899_3GEX_Sample_6996_nuclei@meta.data
umap_899_3GEX_Sample_6996_nuclei    <- srat_899_3GEX_Sample_6996_nuclei@reductions$umap@cell.embeddings
soup.channel_899_3GEX_Sample_6996_nuclei  <- setClusters(soup.channel_899_3GEX_Sample_6996_nuclei, setNames(meta_899_3GEX_Sample_6996_nuclei$seurat_clusters, rownames(meta_899_3GEX_Sample_6996_nuclei)))

soup.channel_899_3GEX_Sample_6996_nuclei  <- setDR(soup.channel_899_3GEX_Sample_6996_nuclei, umap_899_3GEX_Sample_6996_nuclei)
head(meta_899_3GEX_Sample_6996_nuclei)
soup.channel_899_3GEX_Sample_6996_nuclei <- autoEstCont(soup.channel_899_3GEX_Sample_6996_nuclei)
head(soup.channel_899_3GEX_Sample_6996_nuclei$soupProfile[order(soup.channel_899_3GEX_Sample_6996_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_899_3GEX_Sample_6996_nuclei = adjustCounts(soup.channel_899_3GEX_Sample_6996_nuclei)

#Sample 18

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/900_3GEX_Sample_7000_nuclei")
filt.matrix_900_3GEX_Sample_7000_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_900_3GEX_Sample_7000_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_900_3GEX_Sample_7000_nuclei)
str(filt.matrix_900_3GEX_Sample_7000_nuclei)
srat_900_3GEX_Sample_7000_nuclei<-CreateSeuratObject(counts=filt.matrix_900_3GEX_Sample_7000_nuclei)
900_3GEX_Sample_7000_nuclei
soup.channel_900_3GEX_Sample_7000_nuclei<-SoupChannel(raw.matrix_900_3GEX_Sample_7000_nuclei, filt.matrix_900_3GEX_Sample_7000_nuclei)
soup.channel_900_3GEX_Sample_7000_nuclei
srat_900_3GEX_Sample_7000_nuclei <- NormalizeData(srat_900_3GEX_Sample_7000_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_900_3GEX_Sample_7000_nuclei <- FindVariableFeatures(srat_900_3GEX_Sample_7000_nuclei, selection.method = "vst", nfeatures = 2000)
srat_900_3GEX_Sample_7000_nuclei <- ScaleData(srat_900_3GEX_Sample_7000_nuclei)
srat_900_3GEX_Sample_7000_nuclei <- RunPCA(srat_900_3GEX_Sample_7000_nuclei, verbose = F)
srat_900_3GEX_Sample_7000_nuclei <- RunUMAP(srat_900_3GEX_Sample_7000_nuclei, dims = 1:15, verbose = F)
srat_900_3GEX_Sample_7000_nuclei <- FindNeighbors(srat_900_3GEX_Sample_7000_nuclei, dims = 1:15, verbose = F)
srat_900_3GEX_Sample_7000_nuclei <- FindClusters(srat_900_3GEX_Sample_7000_nuclei, verbose = T)

meta_900_3GEX_Sample_7000_nuclei    <- srat_900_3GEX_Sample_7000_nuclei@meta.data
umap_900_3GEX_Sample_7000_nuclei    <- srat_900_3GEX_Sample_7000_nuclei@reductions$umap@cell.embeddings
soup.channel_900_3GEX_Sample_7000_nuclei  <- setClusters(soup.channel_900_3GEX_Sample_7000_nuclei, setNames(meta_900_3GEX_Sample_7000_nuclei$seurat_clusters, rownames(meta_900_3GEX_Sample_7000_nuclei)))

soup.channel_900_3GEX_Sample_7000_nuclei  <- setDR(soup.channel_900_3GEX_Sample_7000_nuclei, umap_900_3GEX_Sample_7000_nuclei)
head(meta_900_3GEX_Sample_7000_nuclei)
soup.channel_900_3GEX_Sample_7000_nuclei <- autoEstCont(soup.channel_900_3GEX_Sample_7000_nuclei)
head(soup.channel_900_3GEX_Sample_7000_nuclei$soupProfile[order(soup.channel_900_3GEX_Sample_7000_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_900_3GEX_Sample_7000_nuclei = adjustCounts(soup.channel_900_3GEX_Sample_7000_nuclei)

#Sample 19
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/919_3GEX_Sample_6979_nuclei")
filt.matrix_919_3GEX_Sample_6979_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_919_3GEX_Sample_6979_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_919_3GEX_Sample_6979_nuclei)
str(filt.matrix_919_3GEX_Sample_6979_nuclei)
srat_919_3GEX_Sample_6979_nuclei<-CreateSeuratObject(counts=filt.matrix_919_3GEX_Sample_6979_nuclei)
919_3GEX_Sample_6979_nuclei
soup.channel_919_3GEX_Sample_6979_nuclei<-SoupChannel(raw.matrix_919_3GEX_Sample_6979_nuclei, filt.matrix_919_3GEX_Sample_6979_nuclei)
soup.channel_919_3GEX_Sample_6979_nuclei
srat_919_3GEX_Sample_6979_nuclei <- NormalizeData(srat_919_3GEX_Sample_6979_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_919_3GEX_Sample_6979_nuclei <- FindVariableFeatures(srat_919_3GEX_Sample_6979_nuclei, selection.method = "vst", nfeatures = 2000)
srat_919_3GEX_Sample_6979_nuclei <- ScaleData(srat_919_3GEX_Sample_6979_nuclei)
srat_919_3GEX_Sample_6979_nuclei <- RunPCA(srat_919_3GEX_Sample_6979_nuclei, verbose = F)
srat_919_3GEX_Sample_6979_nuclei <- RunUMAP(srat_919_3GEX_Sample_6979_nuclei, dims = 1:15, verbose = F)
srat_919_3GEX_Sample_6979_nuclei <- FindNeighbors(srat_919_3GEX_Sample_6979_nuclei, dims = 1:15, verbose = F)
srat_919_3GEX_Sample_6979_nuclei <- FindClusters(srat_919_3GEX_Sample_6979_nuclei, verbose = T)

meta_919_3GEX_Sample_6979_nuclei    <- srat_919_3GEX_Sample_6979_nuclei@meta.data
umap_919_3GEX_Sample_6979_nuclei    <- srat_919_3GEX_Sample_6979_nuclei@reductions$umap@cell.embeddings
soup.channel_919_3GEX_Sample_6979_nuclei  <- setClusters(soup.channel_919_3GEX_Sample_6979_nuclei, setNames(meta_919_3GEX_Sample_6979_nuclei$seurat_clusters, rownames(meta_919_3GEX_Sample_6979_nuclei)))

soup.channel_919_3GEX_Sample_6979_nuclei  <- setDR(soup.channel_919_3GEX_Sample_6979_nuclei, umap_919_3GEX_Sample_6979_nuclei)
head(meta_919_3GEX_Sample_6979_nuclei)
soup.channel_919_3GEX_Sample_6979_nuclei <- autoEstCont(soup.channel_919_3GEX_Sample_6979_nuclei)
head(soup.channel_919_3GEX_Sample_6979_nuclei$soupProfile[order(soup.channel_919_3GEX_Sample_6979_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_919_3GEX_Sample_6979_nuclei = adjustCounts(soup.channel_919_3GEX_Sample_6979_nuclei)

#Sample 20
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/920_3GEX_Sample_6980_nuclei")
filt.matrix_920_3GEX_Sample_6980_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_920_3GEX_Sample_6980_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_920_3GEX_Sample_6980_nuclei)
str(filt.matrix_920_3GEX_Sample_6980_nuclei)
srat_920_3GEX_Sample_6980_nuclei<-CreateSeuratObject(counts=filt.matrix_920_3GEX_Sample_6980_nuclei)
920_3GEX_Sample_6980_nuclei
soup.channel_920_3GEX_Sample_6980_nuclei<-SoupChannel(raw.matrix_920_3GEX_Sample_6980_nuclei, filt.matrix_920_3GEX_Sample_6980_nuclei)
soup.channel_920_3GEX_Sample_6980_nuclei
srat_920_3GEX_Sample_6980_nuclei <- NormalizeData(srat_920_3GEX_Sample_6980_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_920_3GEX_Sample_6980_nuclei <- FindVariableFeatures(srat_920_3GEX_Sample_6980_nuclei, selection.method = "vst", nfeatures = 2000)
srat_920_3GEX_Sample_6980_nuclei <- ScaleData(srat_920_3GEX_Sample_6980_nuclei)
srat_920_3GEX_Sample_6980_nuclei <- RunPCA(srat_920_3GEX_Sample_6980_nuclei, verbose = F)
srat_920_3GEX_Sample_6980_nuclei <- RunUMAP(srat_920_3GEX_Sample_6980_nuclei, dims = 1:15, verbose = F)
srat_920_3GEX_Sample_6980_nuclei <- FindNeighbors(srat_920_3GEX_Sample_6980_nuclei, dims = 1:15, verbose = F)
srat_920_3GEX_Sample_6980_nuclei <- FindClusters(srat_920_3GEX_Sample_6980_nuclei, verbose = T)

meta_920_3GEX_Sample_6980_nuclei    <- srat_920_3GEX_Sample_6980_nuclei@meta.data
umap_920_3GEX_Sample_6980_nuclei    <- srat_920_3GEX_Sample_6980_nuclei@reductions$umap@cell.embeddings
soup.channel_920_3GEX_Sample_6980_nuclei  <- setClusters(soup.channel_920_3GEX_Sample_6980_nuclei, setNames(meta_920_3GEX_Sample_6980_nuclei$seurat_clusters, rownames(meta_920_3GEX_Sample_6980_nuclei)))

soup.channel_920_3GEX_Sample_6980_nuclei  <- setDR(soup.channel_920_3GEX_Sample_6980_nuclei, umap_920_3GEX_Sample_6980_nuclei)
head(meta_920_3GEX_Sample_6980_nuclei)
soup.channel_920_3GEX_Sample_6980_nuclei <- autoEstCont(soup.channel_920_3GEX_Sample_6980_nuclei)
head(soup.channel_920_3GEX_Sample_6980_nuclei$soupProfile[order(soup.channel_920_3GEX_Sample_6980_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_920_3GEX_Sample_6980_nuclei = adjustCounts(soup.channel_920_3GEX_Sample_6980_nuclei)


#Sample 21

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/921_3GEX_Sample_6984_nuclei")
filt.matrix_921_3GEX_Sample_6984_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_921_3GEX_Sample_6984_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_921_3GEX_Sample_6984_nuclei)
str(filt.matrix_921_3GEX_Sample_6984_nuclei)
srat_921_3GEX_Sample_6984_nuclei<-CreateSeuratObject(counts=filt.matrix_921_3GEX_Sample_6984_nuclei)
921_3GEX_Sample_6984_nuclei
soup.channel_921_3GEX_Sample_6984_nuclei<-SoupChannel(raw.matrix_921_3GEX_Sample_6984_nuclei, filt.matrix_921_3GEX_Sample_6984_nuclei)
soup.channel_921_3GEX_Sample_6984_nuclei
srat_921_3GEX_Sample_6984_nuclei <- NormalizeData(srat_921_3GEX_Sample_6984_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_921_3GEX_Sample_6984_nuclei <- FindVariableFeatures(srat_921_3GEX_Sample_6984_nuclei, selection.method = "vst", nfeatures = 2000)
srat_921_3GEX_Sample_6984_nuclei <- ScaleData(srat_921_3GEX_Sample_6984_nuclei)
srat_921_3GEX_Sample_6984_nuclei <- RunPCA(srat_921_3GEX_Sample_6984_nuclei, verbose = F)
srat_921_3GEX_Sample_6984_nuclei <- RunUMAP(srat_921_3GEX_Sample_6984_nuclei, dims = 1:15, verbose = F)
srat_921_3GEX_Sample_6984_nuclei <- FindNeighbors(srat_921_3GEX_Sample_6984_nuclei, dims = 1:15, verbose = F)
srat_921_3GEX_Sample_6984_nuclei <- FindClusters(srat_921_3GEX_Sample_6984_nuclei, verbose = T)

meta_921_3GEX_Sample_6984_nuclei    <- srat_921_3GEX_Sample_6984_nuclei@meta.data
umap_921_3GEX_Sample_6984_nuclei    <- srat_921_3GEX_Sample_6984_nuclei@reductions$umap@cell.embeddings
soup.channel_921_3GEX_Sample_6984_nuclei  <- setClusters(soup.channel_921_3GEX_Sample_6984_nuclei, setNames(meta_921_3GEX_Sample_6984_nuclei$seurat_clusters, rownames(meta_921_3GEX_Sample_6984_nuclei)))

soup.channel_921_3GEX_Sample_6984_nuclei  <- setDR(soup.channel_921_3GEX_Sample_6984_nuclei, umap_921_3GEX_Sample_6984_nuclei)
head(meta_921_3GEX_Sample_6984_nuclei)
soup.channel_921_3GEX_Sample_6984_nuclei <- autoEstCont(soup.channel_921_3GEX_Sample_6984_nuclei)
head(soup.channel_921_3GEX_Sample_6984_nuclei$soupProfile[order(soup.channel_921_3GEX_Sample_6984_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_921_3GEX_Sample_6984_nuclei = adjustCounts(soup.channel_921_3GEX_Sample_6984_nuclei)

#Sample 22

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/922_3GEX_Sample_6986_nuclei")
filt.matrix_922_3GEX_Sample_6986_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_922_3GEX_Sample_6986_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_922_3GEX_Sample_6986_nuclei)
str(filt.matrix_922_3GEX_Sample_6986_nuclei)
srat_922_3GEX_Sample_6986_nuclei<-CreateSeuratObject(counts=filt.matrix_922_3GEX_Sample_6986_nuclei)
922_3GEX_Sample_6986_nuclei
soup.channel_922_3GEX_Sample_6986_nuclei<-SoupChannel(raw.matrix_922_3GEX_Sample_6986_nuclei, filt.matrix_922_3GEX_Sample_6986_nuclei)
soup.channel_922_3GEX_Sample_6986_nuclei
srat_922_3GEX_Sample_6986_nuclei <- NormalizeData(srat_922_3GEX_Sample_6986_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_922_3GEX_Sample_6986_nuclei <- FindVariableFeatures(srat_922_3GEX_Sample_6986_nuclei, selection.method = "vst", nfeatures = 2000)
srat_922_3GEX_Sample_6986_nuclei <- ScaleData(srat_922_3GEX_Sample_6986_nuclei)
srat_922_3GEX_Sample_6986_nuclei <- RunPCA(srat_922_3GEX_Sample_6986_nuclei, verbose = F)
srat_922_3GEX_Sample_6986_nuclei <- RunUMAP(srat_922_3GEX_Sample_6986_nuclei, dims = 1:15, verbose = F)
srat_922_3GEX_Sample_6986_nuclei <- FindNeighbors(srat_922_3GEX_Sample_6986_nuclei, dims = 1:15, verbose = F)
srat_922_3GEX_Sample_6986_nuclei <- FindClusters(srat_922_3GEX_Sample_6986_nuclei, verbose = T)

meta_922_3GEX_Sample_6986_nuclei    <- srat_922_3GEX_Sample_6986_nuclei@meta.data
umap_922_3GEX_Sample_6986_nuclei    <- srat_922_3GEX_Sample_6986_nuclei@reductions$umap@cell.embeddings
soup.channel_922_3GEX_Sample_6986_nuclei  <- setClusters(soup.channel_922_3GEX_Sample_6986_nuclei, setNames(meta_922_3GEX_Sample_6986_nuclei$seurat_clusters, rownames(meta_922_3GEX_Sample_6986_nuclei)))

soup.channel_922_3GEX_Sample_6986_nuclei  <- setDR(soup.channel_922_3GEX_Sample_6986_nuclei, umap_922_3GEX_Sample_6986_nuclei)
head(meta_922_3GEX_Sample_6986_nuclei)
soup.channel_922_3GEX_Sample_6986_nuclei <- autoEstCont(soup.channel_922_3GEX_Sample_6986_nuclei)
head(soup.channel_922_3GEX_Sample_6986_nuclei$soupProfile[order(soup.channel_922_3GEX_Sample_6986_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_922_3GEX_Sample_6986_nuclei = adjustCounts(soup.channel_922_3GEX_Sample_6986_nuclei)

#Sample 23
#Sample 2
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/923_3GEX_Sample_6987_nuclei")
filt.matrix_923_3GEX_Sample_6987_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_923_3GEX_Sample_6987_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_923_3GEX_Sample_6987_nuclei)
str(filt.matrix_923_3GEX_Sample_6987_nuclei)
srat_923_3GEX_Sample_6987_nuclei<-CreateSeuratObject(counts=filt.matrix_923_3GEX_Sample_6987_nuclei)
923_3GEX_Sample_6987_nuclei
soup.channel_923_3GEX_Sample_6987_nuclei<-SoupChannel(raw.matrix_923_3GEX_Sample_6987_nuclei, filt.matrix_923_3GEX_Sample_6987_nuclei)
soup.channel_923_3GEX_Sample_6987_nuclei
srat_923_3GEX_Sample_6987_nuclei <- NormalizeData(srat_923_3GEX_Sample_6987_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_923_3GEX_Sample_6987_nuclei <- FindVariableFeatures(srat_923_3GEX_Sample_6987_nuclei, selection.method = "vst", nfeatures = 2000)
srat_923_3GEX_Sample_6987_nuclei <- ScaleData(srat_923_3GEX_Sample_6987_nuclei)
srat_923_3GEX_Sample_6987_nuclei <- RunPCA(srat_923_3GEX_Sample_6987_nuclei, verbose = F)
srat_923_3GEX_Sample_6987_nuclei <- RunUMAP(srat_923_3GEX_Sample_6987_nuclei, dims = 1:15, verbose = F)
srat_923_3GEX_Sample_6987_nuclei <- FindNeighbors(srat_923_3GEX_Sample_6987_nuclei, dims = 1:15, verbose = F)
srat_923_3GEX_Sample_6987_nuclei <- FindClusters(srat_923_3GEX_Sample_6987_nuclei, verbose = T)

meta_923_3GEX_Sample_6987_nuclei    <- srat_923_3GEX_Sample_6987_nuclei@meta.data
umap_923_3GEX_Sample_6987_nuclei    <- srat_923_3GEX_Sample_6987_nuclei@reductions$umap@cell.embeddings
soup.channel_923_3GEX_Sample_6987_nuclei  <- setClusters(soup.channel_923_3GEX_Sample_6987_nuclei, setNames(meta_923_3GEX_Sample_6987_nuclei$seurat_clusters, rownames(meta_923_3GEX_Sample_6987_nuclei)))

soup.channel_923_3GEX_Sample_6987_nuclei  <- setDR(soup.channel_923_3GEX_Sample_6987_nuclei, umap_923_3GEX_Sample_6987_nuclei)
head(meta_923_3GEX_Sample_6987_nuclei)
soup.channel_923_3GEX_Sample_6987_nuclei <- autoEstCont(soup.channel_923_3GEX_Sample_6987_nuclei)
head(soup.channel_923_3GEX_Sample_6987_nuclei$soupProfile[order(soup.channel_923_3GEX_Sample_6987_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_923_3GEX_Sample_6987_nuclei = adjustCounts(soup.channel_923_3GEX_Sample_6987_nuclei)

#Sample 24

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/924_3GEX_Sample_6988_nuclei")
filt.matrix_924_3GEX_Sample_6988_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_924_3GEX_Sample_6988_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_924_3GEX_Sample_6988_nuclei)
str(filt.matrix_924_3GEX_Sample_6988_nuclei)
srat_924_3GEX_Sample_6988_nuclei<-CreateSeuratObject(counts=filt.matrix_924_3GEX_Sample_6988_nuclei)
924_3GEX_Sample_6988_nuclei
soup.channel_924_3GEX_Sample_6988_nuclei<-SoupChannel(raw.matrix_924_3GEX_Sample_6988_nuclei, filt.matrix_924_3GEX_Sample_6988_nuclei)
soup.channel_924_3GEX_Sample_6988_nuclei
srat_924_3GEX_Sample_6988_nuclei <- NormalizeData(srat_924_3GEX_Sample_6988_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_924_3GEX_Sample_6988_nuclei <- FindVariableFeatures(srat_924_3GEX_Sample_6988_nuclei, selection.method = "vst", nfeatures = 2000)
srat_924_3GEX_Sample_6988_nuclei <- ScaleData(srat_924_3GEX_Sample_6988_nuclei)
srat_924_3GEX_Sample_6988_nuclei <- RunPCA(srat_924_3GEX_Sample_6988_nuclei, verbose = F)
srat_924_3GEX_Sample_6988_nuclei <- RunUMAP(srat_924_3GEX_Sample_6988_nuclei, dims = 1:15, verbose = F)
srat_924_3GEX_Sample_6988_nuclei <- FindNeighbors(srat_924_3GEX_Sample_6988_nuclei, dims = 1:15, verbose = F)
srat_924_3GEX_Sample_6988_nuclei <- FindClusters(srat_924_3GEX_Sample_6988_nuclei, verbose = T)

meta_924_3GEX_Sample_6988_nuclei    <- srat_924_3GEX_Sample_6988_nuclei@meta.data
umap_924_3GEX_Sample_6988_nuclei    <- srat_924_3GEX_Sample_6988_nuclei@reductions$umap@cell.embeddings
soup.channel_924_3GEX_Sample_6988_nuclei  <- setClusters(soup.channel_924_3GEX_Sample_6988_nuclei, setNames(meta_924_3GEX_Sample_6988_nuclei$seurat_clusters, rownames(meta_924_3GEX_Sample_6988_nuclei)))

soup.channel_924_3GEX_Sample_6988_nuclei  <- setDR(soup.channel_924_3GEX_Sample_6988_nuclei, umap_924_3GEX_Sample_6988_nuclei)
head(meta_924_3GEX_Sample_6988_nuclei)
soup.channel_924_3GEX_Sample_6988_nuclei <- autoEstCont(soup.channel_924_3GEX_Sample_6988_nuclei)
head(soup.channel_924_3GEX_Sample_6988_nuclei$soupProfile[order(soup.channel_924_3GEX_Sample_6988_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_924_3GEX_Sample_6988_nuclei = adjustCounts(soup.channel_924_3GEX_Sample_6988_nuclei)

#Sample 25

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/925_3GEX_Sample_6989_nuclei")
filt.matrix_925_3GEX_Sample_6989_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_925_3GEX_Sample_6989_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_925_3GEX_Sample_6989_nuclei)
str(filt.matrix_925_3GEX_Sample_6989_nuclei)
srat_925_3GEX_Sample_6989_nuclei<-CreateSeuratObject(counts=filt.matrix_925_3GEX_Sample_6989_nuclei)
925_3GEX_Sample_6989_nuclei
soup.channel_925_3GEX_Sample_6989_nuclei<-SoupChannel(raw.matrix_925_3GEX_Sample_6989_nuclei, filt.matrix_925_3GEX_Sample_6989_nuclei)
soup.channel_925_3GEX_Sample_6989_nuclei
srat_925_3GEX_Sample_6989_nuclei <- NormalizeData(srat_925_3GEX_Sample_6989_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_925_3GEX_Sample_6989_nuclei <- FindVariableFeatures(srat_925_3GEX_Sample_6989_nuclei, selection.method = "vst", nfeatures = 2000)
srat_925_3GEX_Sample_6989_nuclei <- ScaleData(srat_925_3GEX_Sample_6989_nuclei)
srat_925_3GEX_Sample_6989_nuclei <- RunPCA(srat_925_3GEX_Sample_6989_nuclei, verbose = F)
srat_925_3GEX_Sample_6989_nuclei <- RunUMAP(srat_925_3GEX_Sample_6989_nuclei, dims = 1:15, verbose = F)
srat_925_3GEX_Sample_6989_nuclei <- FindNeighbors(srat_925_3GEX_Sample_6989_nuclei, dims = 1:15, verbose = F)
srat_925_3GEX_Sample_6989_nuclei <- FindClusters(srat_925_3GEX_Sample_6989_nuclei, verbose = T)

meta_925_3GEX_Sample_6989_nuclei    <- srat_925_3GEX_Sample_6989_nuclei@meta.data
umap_925_3GEX_Sample_6989_nuclei    <- srat_925_3GEX_Sample_6989_nuclei@reductions$umap@cell.embeddings
soup.channel_925_3GEX_Sample_6989_nuclei  <- setClusters(soup.channel_925_3GEX_Sample_6989_nuclei, setNames(meta_925_3GEX_Sample_6989_nuclei$seurat_clusters, rownames(meta_925_3GEX_Sample_6989_nuclei)))

soup.channel_925_3GEX_Sample_6989_nuclei  <- setDR(soup.channel_925_3GEX_Sample_6989_nuclei, umap_925_3GEX_Sample_6989_nuclei)
head(meta_925_3GEX_Sample_6989_nuclei)
soup.channel_925_3GEX_Sample_6989_nuclei <- autoEstCont(soup.channel_925_3GEX_Sample_6989_nuclei)
head(soup.channel_925_3GEX_Sample_6989_nuclei$soupProfile[order(soup.channel_925_3GEX_Sample_6989_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_925_3GEX_Sample_6989_nuclei = adjustCounts(soup.channel_925_3GEX_Sample_6989_nuclei)

#Sample 26

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/938_3GEX_Sample_620_nuclei")
filt.matrix_938_3GEX_Sample_620_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_938_3GEX_Sample_620_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_938_3GEX_Sample_620_nuclei)
str(filt.matrix_938_3GEX_Sample_620_nuclei)
srat_938_3GEX_Sample_620_nuclei<-CreateSeuratObject(counts=filt.matrix_938_3GEX_Sample_620_nuclei)
938_3GEX_Sample_620_nuclei
soup.channel_938_3GEX_Sample_620_nuclei<-SoupChannel(raw.matrix_938_3GEX_Sample_620_nuclei, filt.matrix_938_3GEX_Sample_620_nuclei)
soup.channel_938_3GEX_Sample_620_nuclei
srat_938_3GEX_Sample_620_nuclei <- NormalizeData(srat_938_3GEX_Sample_620_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_938_3GEX_Sample_620_nuclei <- FindVariableFeatures(srat_938_3GEX_Sample_620_nuclei, selection.method = "vst", nfeatures = 2000)
srat_938_3GEX_Sample_620_nuclei <- ScaleData(srat_938_3GEX_Sample_620_nuclei)
srat_938_3GEX_Sample_620_nuclei <- RunPCA(srat_938_3GEX_Sample_620_nuclei, verbose = F)
srat_938_3GEX_Sample_620_nuclei <- RunUMAP(srat_938_3GEX_Sample_620_nuclei, dims = 1:15, verbose = F)
srat_938_3GEX_Sample_620_nuclei <- FindNeighbors(srat_938_3GEX_Sample_620_nuclei, dims = 1:15, verbose = F)
srat_938_3GEX_Sample_620_nuclei <- FindClusters(srat_938_3GEX_Sample_620_nuclei, verbose = T)

meta_938_3GEX_Sample_620_nuclei    <- srat_938_3GEX_Sample_620_nuclei@meta.data
umap_938_3GEX_Sample_620_nuclei    <- srat_938_3GEX_Sample_620_nuclei@reductions$umap@cell.embeddings
soup.channel_938_3GEX_Sample_620_nuclei  <- setClusters(soup.channel_938_3GEX_Sample_620_nuclei, setNames(meta_938_3GEX_Sample_620_nuclei$seurat_clusters, rownames(meta_938_3GEX_Sample_620_nuclei)))

soup.channel_938_3GEX_Sample_620_nuclei  <- setDR(soup.channel_938_3GEX_Sample_620_nuclei, umap_938_3GEX_Sample_620_nuclei)
head(meta_938_3GEX_Sample_620_nuclei)
soup.channel_938_3GEX_Sample_620_nuclei <- autoEstCont(soup.channel_938_3GEX_Sample_620_nuclei)
head(soup.channel_938_3GEX_Sample_620_nuclei$soupProfile[order(soup.channel_938_3GEX_Sample_620_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_938_3GEX_Sample_620_nuclei = adjustCounts(soup.channel_938_3GEX_Sample_620_nuclei)

#Sample 27

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/940_3GEX_Sample_663C_nuclei")
filt.matrix_940_3GEX_Sample_663C_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_940_3GEX_Sample_663C_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_940_3GEX_Sample_663C_nuclei)
str(filt.matrix_940_3GEX_Sample_663C_nuclei)
srat_940_3GEX_Sample_663C_nuclei<-CreateSeuratObject(counts=filt.matrix_940_3GEX_Sample_663C_nuclei)
940_3GEX_Sample_663C_nuclei
soup.channel_940_3GEX_Sample_663C_nuclei<-SoupChannel(raw.matrix_940_3GEX_Sample_663C_nuclei, filt.matrix_940_3GEX_Sample_663C_nuclei)
soup.channel_940_3GEX_Sample_663C_nuclei
srat_940_3GEX_Sample_663C_nuclei <- NormalizeData(srat_940_3GEX_Sample_663C_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_940_3GEX_Sample_663C_nuclei <- FindVariableFeatures(srat_940_3GEX_Sample_663C_nuclei, selection.method = "vst", nfeatures = 2000)
srat_940_3GEX_Sample_663C_nuclei <- ScaleData(srat_940_3GEX_Sample_663C_nuclei)
srat_940_3GEX_Sample_663C_nuclei <- RunPCA(srat_940_3GEX_Sample_663C_nuclei, verbose = F)
srat_940_3GEX_Sample_663C_nuclei <- RunUMAP(srat_940_3GEX_Sample_663C_nuclei, dims = 1:15, verbose = F)
srat_940_3GEX_Sample_663C_nuclei <- FindNeighbors(srat_940_3GEX_Sample_663C_nuclei, dims = 1:15, verbose = F)
srat_940_3GEX_Sample_663C_nuclei <- FindClusters(srat_940_3GEX_Sample_663C_nuclei, verbose = T)

meta_940_3GEX_Sample_663C_nuclei    <- srat_940_3GEX_Sample_663C_nuclei@meta.data
umap_940_3GEX_Sample_663C_nuclei    <- srat_940_3GEX_Sample_663C_nuclei@reductions$umap@cell.embeddings
soup.channel_940_3GEX_Sample_663C_nuclei  <- setClusters(soup.channel_940_3GEX_Sample_663C_nuclei, setNames(meta_940_3GEX_Sample_663C_nuclei$seurat_clusters, rownames(meta_940_3GEX_Sample_663C_nuclei)))

soup.channel_940_3GEX_Sample_663C_nuclei  <- setDR(soup.channel_940_3GEX_Sample_663C_nuclei, umap_940_3GEX_Sample_663C_nuclei)
head(meta_940_3GEX_Sample_663C_nuclei)
soup.channel_940_3GEX_Sample_663C_nuclei <- autoEstCont(soup.channel_940_3GEX_Sample_663C_nuclei)
head(soup.channel_940_3GEX_Sample_663C_nuclei$soupProfile[order(soup.channel_940_3GEX_Sample_663C_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_940_3GEX_Sample_663C_nuclei = adjustCounts(soup.channel_940_3GEX_Sample_663C_nuclei)

#Sample 28

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/942_3GEX_Sample_635_nuclei")
filt.matrix_942_3GEX_Sample_635_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_942_3GEX_Sample_635_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_942_3GEX_Sample_635_nuclei)
str(filt.matrix_942_3GEX_Sample_635_nuclei)
srat_942_3GEX_Sample_635_nuclei<-CreateSeuratObject(counts=filt.matrix_942_3GEX_Sample_635_nuclei)
942_3GEX_Sample_635_nuclei
soup.channel_942_3GEX_Sample_635_nuclei<-SoupChannel(raw.matrix_942_3GEX_Sample_635_nuclei, filt.matrix_942_3GEX_Sample_635_nuclei)
soup.channel_942_3GEX_Sample_635_nuclei
srat_942_3GEX_Sample_635_nuclei <- NormalizeData(srat_942_3GEX_Sample_635_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_942_3GEX_Sample_635_nuclei <- FindVariableFeatures(srat_942_3GEX_Sample_635_nuclei, selection.method = "vst", nfeatures = 2000)
srat_942_3GEX_Sample_635_nuclei <- ScaleData(srat_942_3GEX_Sample_635_nuclei)
srat_942_3GEX_Sample_635_nuclei <- RunPCA(srat_942_3GEX_Sample_635_nuclei, verbose = F)
srat_942_3GEX_Sample_635_nuclei <- RunUMAP(srat_942_3GEX_Sample_635_nuclei, dims = 1:15, verbose = F)
srat_942_3GEX_Sample_635_nuclei <- FindNeighbors(srat_942_3GEX_Sample_635_nuclei, dims = 1:15, verbose = F)
srat_942_3GEX_Sample_635_nuclei <- FindClusters(srat_942_3GEX_Sample_635_nuclei, verbose = T)

meta_942_3GEX_Sample_635_nuclei    <- srat_942_3GEX_Sample_635_nuclei@meta.data
umap_942_3GEX_Sample_635_nuclei    <- srat_942_3GEX_Sample_635_nuclei@reductions$umap@cell.embeddings
soup.channel_942_3GEX_Sample_635_nuclei  <- setClusters(soup.channel_942_3GEX_Sample_635_nuclei, setNames(meta_942_3GEX_Sample_635_nuclei$seurat_clusters, rownames(meta_942_3GEX_Sample_635_nuclei)))

soup.channel_942_3GEX_Sample_635_nuclei  <- setDR(soup.channel_942_3GEX_Sample_635_nuclei, umap_942_3GEX_Sample_635_nuclei)
head(meta_942_3GEX_Sample_635_nuclei)
soup.channel_942_3GEX_Sample_635_nuclei <- autoEstCont(soup.channel_942_3GEX_Sample_635_nuclei)
head(soup.channel_942_3GEX_Sample_635_nuclei$soupProfile[order(soup.channel_942_3GEX_Sample_635_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_942_3GEX_Sample_635_nuclei = adjustCounts(soup.channel_942_3GEX_Sample_635_nuclei)

#Sample 29

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/943_3GEX_Sample_646_nuclei")
filt.matrix_943_3GEX_Sample_646_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_943_3GEX_Sample_646_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_943_3GEX_Sample_646_nuclei)
str(filt.matrix_943_3GEX_Sample_646_nuclei)
srat_943_3GEX_Sample_646_nuclei<-CreateSeuratObject(counts=filt.matrix_943_3GEX_Sample_646_nuclei)
943_3GEX_Sample_646_nuclei
soup.channel_943_3GEX_Sample_646_nuclei<-SoupChannel(raw.matrix_943_3GEX_Sample_646_nuclei, filt.matrix_943_3GEX_Sample_646_nuclei)
soup.channel_943_3GEX_Sample_646_nuclei
srat_943_3GEX_Sample_646_nuclei <- NormalizeData(srat_943_3GEX_Sample_646_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_943_3GEX_Sample_646_nuclei <- FindVariableFeatures(srat_943_3GEX_Sample_646_nuclei, selection.method = "vst", nfeatures = 2000)
srat_943_3GEX_Sample_646_nuclei <- ScaleData(srat_943_3GEX_Sample_646_nuclei)
srat_943_3GEX_Sample_646_nuclei <- RunPCA(srat_943_3GEX_Sample_646_nuclei, verbose = F)
srat_943_3GEX_Sample_646_nuclei <- RunUMAP(srat_943_3GEX_Sample_646_nuclei, dims = 1:15, verbose = F)
srat_943_3GEX_Sample_646_nuclei <- FindNeighbors(srat_943_3GEX_Sample_646_nuclei, dims = 1:15, verbose = F)
srat_943_3GEX_Sample_646_nuclei <- FindClusters(srat_943_3GEX_Sample_646_nuclei, verbose = T)

meta_943_3GEX_Sample_646_nuclei    <- srat_943_3GEX_Sample_646_nuclei@meta.data
umap_943_3GEX_Sample_646_nuclei    <- srat_943_3GEX_Sample_646_nuclei@reductions$umap@cell.embeddings
soup.channel_943_3GEX_Sample_646_nuclei  <- setClusters(soup.channel_943_3GEX_Sample_646_nuclei, setNames(meta_943_3GEX_Sample_646_nuclei$seurat_clusters, rownames(meta_943_3GEX_Sample_646_nuclei)))

soup.channel_943_3GEX_Sample_646_nuclei  <- setDR(soup.channel_943_3GEX_Sample_646_nuclei, umap_943_3GEX_Sample_646_nuclei)
head(meta_943_3GEX_Sample_646_nuclei)
soup.channel_943_3GEX_Sample_646_nuclei <- autoEstCont(soup.channel_943_3GEX_Sample_646_nuclei)
head(soup.channel_943_3GEX_Sample_646_nuclei$soupProfile[order(soup.channel_943_3GEX_Sample_646_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_943_3GEX_Sample_646_nuclei = adjustCounts(soup.channel_943_3GEX_Sample_646_nuclei)

#Sample 30

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/944_3GEX_Sample_650_nuclei")
filt.matrix_944_3GEX_Sample_650_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_944_3GEX_Sample_650_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_944_3GEX_Sample_650_nuclei)
str(filt.matrix_944_3GEX_Sample_650_nuclei)
srat_944_3GEX_Sample_650_nuclei<-CreateSeuratObject(counts=filt.matrix_944_3GEX_Sample_650_nuclei)
944_3GEX_Sample_650_nuclei
soup.channel_944_3GEX_Sample_650_nuclei<-SoupChannel(raw.matrix_944_3GEX_Sample_650_nuclei, filt.matrix_944_3GEX_Sample_650_nuclei)
soup.channel_944_3GEX_Sample_650_nuclei
srat_944_3GEX_Sample_650_nuclei <- NormalizeData(srat_944_3GEX_Sample_650_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_944_3GEX_Sample_650_nuclei <- FindVariableFeatures(srat_944_3GEX_Sample_650_nuclei, selection.method = "vst", nfeatures = 2000)
srat_944_3GEX_Sample_650_nuclei <- ScaleData(srat_944_3GEX_Sample_650_nuclei)
srat_944_3GEX_Sample_650_nuclei <- RunPCA(srat_944_3GEX_Sample_650_nuclei, verbose = F)
srat_944_3GEX_Sample_650_nuclei <- RunUMAP(srat_944_3GEX_Sample_650_nuclei, dims = 1:15, verbose = F)
srat_944_3GEX_Sample_650_nuclei <- FindNeighbors(srat_944_3GEX_Sample_650_nuclei, dims = 1:15, verbose = F)
srat_944_3GEX_Sample_650_nuclei <- FindClusters(srat_944_3GEX_Sample_650_nuclei, verbose = T)

meta_944_3GEX_Sample_650_nuclei    <- srat_944_3GEX_Sample_650_nuclei@meta.data
umap_944_3GEX_Sample_650_nuclei    <- srat_944_3GEX_Sample_650_nuclei@reductions$umap@cell.embeddings
soup.channel_944_3GEX_Sample_650_nuclei  <- setClusters(soup.channel_944_3GEX_Sample_650_nuclei, setNames(meta_944_3GEX_Sample_650_nuclei$seurat_clusters, rownames(meta_944_3GEX_Sample_650_nuclei)))

soup.channel_944_3GEX_Sample_650_nuclei  <- setDR(soup.channel_944_3GEX_Sample_650_nuclei, umap_944_3GEX_Sample_650_nuclei)
head(meta_944_3GEX_Sample_650_nuclei)
soup.channel_944_3GEX_Sample_650_nuclei <- autoEstCont(soup.channel_944_3GEX_Sample_650_nuclei)
head(soup.channel_944_3GEX_Sample_650_nuclei$soupProfile[order(soup.channel_944_3GEX_Sample_650_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_944_3GEX_Sample_650_nuclei = adjustCounts(soup.channel_944_3GEX_Sample_650_nuclei)

#Sample 31

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/945_3GEX_Sample_693_nuclei")
filt.matrix_945_3GEX_Sample_693_nuclei<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_945_3GEX_Sample_693_nuclei<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_945_3GEX_Sample_693_nuclei)
str(filt.matrix_945_3GEX_Sample_693_nuclei)
srat_945_3GEX_Sample_693_nuclei<-CreateSeuratObject(counts=filt.matrix_945_3GEX_Sample_693_nuclei)
945_3GEX_Sample_693_nuclei
soup.channel_945_3GEX_Sample_693_nuclei<-SoupChannel(raw.matrix_945_3GEX_Sample_693_nuclei, filt.matrix_945_3GEX_Sample_693_nuclei)
soup.channel_945_3GEX_Sample_693_nuclei
srat_945_3GEX_Sample_693_nuclei <- NormalizeData(srat_945_3GEX_Sample_693_nuclei, normalization.method = "LogNormalize", scale.factor = 10000)

srat_945_3GEX_Sample_693_nuclei <- FindVariableFeatures(srat_945_3GEX_Sample_693_nuclei, selection.method = "vst", nfeatures = 2000)
srat_945_3GEX_Sample_693_nuclei <- ScaleData(srat_945_3GEX_Sample_693_nuclei)
srat_945_3GEX_Sample_693_nuclei <- RunPCA(srat_945_3GEX_Sample_693_nuclei, verbose = F)
srat_945_3GEX_Sample_693_nuclei <- RunUMAP(srat_945_3GEX_Sample_693_nuclei, dims = 1:15, verbose = F)
srat_945_3GEX_Sample_693_nuclei <- FindNeighbors(srat_945_3GEX_Sample_693_nuclei, dims = 1:15, verbose = F)
srat_945_3GEX_Sample_693_nuclei <- FindClusters(srat_945_3GEX_Sample_693_nuclei, verbose = T)

meta_945_3GEX_Sample_693_nuclei    <- srat_945_3GEX_Sample_693_nuclei@meta.data
umap_945_3GEX_Sample_693_nuclei    <- srat_945_3GEX_Sample_693_nuclei@reductions$umap@cell.embeddings
soup.channel_945_3GEX_Sample_693_nuclei  <- setClusters(soup.channel_945_3GEX_Sample_693_nuclei, setNames(meta_945_3GEX_Sample_693_nuclei$seurat_clusters, rownames(meta_945_3GEX_Sample_693_nuclei)))

soup.channel_945_3GEX_Sample_693_nuclei  <- setDR(soup.channel_945_3GEX_Sample_693_nuclei, umap_945_3GEX_Sample_693_nuclei)
head(meta_945_3GEX_Sample_693_nuclei)
soup.channel_945_3GEX_Sample_693_nuclei <- autoEstCont(soup.channel_945_3GEX_Sample_693_nuclei)
head(soup.channel_945_3GEX_Sample_693_nuclei$soupProfile[order(soup.channel_945_3GEX_Sample_693_nuclei$soupProfile$est, decreasing = T), ], n = 20)

out_945_3GEX_Sample_693_nuclei = adjustCounts(soup.channel_945_3GEX_Sample_693_nuclei)

#Sample 32

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/947_GEX_Sample_180")
filt.matrix_947_GEX_Sample_180<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_947_GEX_Sample_180<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_947_GEX_Sample_180)
str(filt.matrix_947_GEX_Sample_180)
srat_947_GEX_Sample_180<-CreateSeuratObject(counts=filt.matrix_947_GEX_Sample_180)
947_GEX_Sample_180
soup.channel_947_GEX_Sample_180<-SoupChannel(raw.matrix_947_GEX_Sample_180, filt.matrix_947_GEX_Sample_180)
soup.channel_947_GEX_Sample_180
srat_947_GEX_Sample_180 <- NormalizeData(srat_947_GEX_Sample_180, normalization.method = "LogNormalize", scale.factor = 10000)

srat_947_GEX_Sample_180 <- FindVariableFeatures(srat_947_GEX_Sample_180, selection.method = "vst", nfeatures = 2000)
srat_947_GEX_Sample_180 <- ScaleData(srat_947_GEX_Sample_180)
srat_947_GEX_Sample_180 <- RunPCA(srat_947_GEX_Sample_180, verbose = F)
srat_947_GEX_Sample_180 <- RunUMAP(srat_947_GEX_Sample_180, dims = 1:15, verbose = F)
srat_947_GEX_Sample_180 <- FindNeighbors(srat_947_GEX_Sample_180, dims = 1:15, verbose = F)
srat_947_GEX_Sample_180 <- FindClusters(srat_947_GEX_Sample_180, verbose = T)

meta_947_GEX_Sample_180    <- srat_947_GEX_Sample_180@meta.data
umap_947_GEX_Sample_180    <- srat_947_GEX_Sample_180@reductions$umap@cell.embeddings
soup.channel_947_GEX_Sample_180  <- setClusters(soup.channel_947_GEX_Sample_180, setNames(meta_947_GEX_Sample_180$seurat_clusters, rownames(meta_947_GEX_Sample_180)))

soup.channel_947_GEX_Sample_180  <- setDR(soup.channel_947_GEX_Sample_180, umap_947_GEX_Sample_180)
head(meta_947_GEX_Sample_180)
soup.channel_947_GEX_Sample_180 <- autoEstCont(soup.channel_947_GEX_Sample_180)
head(soup.channel_947_GEX_Sample_180$soupProfile[order(soup.channel_947_GEX_Sample_180$soupProfile$est, decreasing = T), ], n = 20)

out_947_GEX_Sample_180 = adjustCounts(soup.channel_947_GEX_Sample_180)

#Sample 33

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/948_GEX_Sample_656")
filt.matrix_948_GEX_Sample_656<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_948_GEX_Sample_656<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_948_GEX_Sample_656)
str(filt.matrix_948_GEX_Sample_656)
srat_948_GEX_Sample_656<-CreateSeuratObject(counts=filt.matrix_948_GEX_Sample_656)
948_GEX_Sample_656
soup.channel_948_GEX_Sample_656<-SoupChannel(raw.matrix_948_GEX_Sample_656, filt.matrix_948_GEX_Sample_656)
soup.channel_948_GEX_Sample_656
srat_948_GEX_Sample_656 <- NormalizeData(srat_948_GEX_Sample_656, normalization.method = "LogNormalize", scale.factor = 10000)

srat_948_GEX_Sample_656 <- FindVariableFeatures(srat_948_GEX_Sample_656, selection.method = "vst", nfeatures = 2000)
srat_948_GEX_Sample_656 <- ScaleData(srat_948_GEX_Sample_656)
srat_948_GEX_Sample_656 <- RunPCA(srat_948_GEX_Sample_656, verbose = F)
srat_948_GEX_Sample_656 <- RunUMAP(srat_948_GEX_Sample_656, dims = 1:15, verbose = F)
srat_948_GEX_Sample_656 <- FindNeighbors(srat_948_GEX_Sample_656, dims = 1:15, verbose = F)
srat_948_GEX_Sample_656 <- FindClusters(srat_948_GEX_Sample_656, verbose = T)

meta_948_GEX_Sample_656    <- srat_948_GEX_Sample_656@meta.data
umap_948_GEX_Sample_656    <- srat_948_GEX_Sample_656@reductions$umap@cell.embeddings
soup.channel_948_GEX_Sample_656  <- setClusters(soup.channel_948_GEX_Sample_656, setNames(meta_948_GEX_Sample_656$seurat_clusters, rownames(meta_948_GEX_Sample_656)))

soup.channel_948_GEX_Sample_656  <- setDR(soup.channel_948_GEX_Sample_656, umap_948_GEX_Sample_656)
head(meta_948_GEX_Sample_656)
soup.channel_948_GEX_Sample_656 <- autoEstCont(soup.channel_948_GEX_Sample_656)
head(soup.channel_948_GEX_Sample_656$soupProfile[order(soup.channel_948_GEX_Sample_656$soupProfile$est, decreasing = T), ], n = 20)

out_948_GEX_Sample_656 = adjustCounts(soup.channel_948_GEX_Sample_656)

#Sample 34

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/949_GEX_Sample_688")
filt.matrix_949_GEX_Sample_688<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_949_GEX_Sample_688<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_949_GEX_Sample_688)
str(filt.matrix_949_GEX_Sample_688)
srat_949_GEX_Sample_688<-CreateSeuratObject(counts=filt.matrix_949_GEX_Sample_688)
949_GEX_Sample_688
soup.channel_949_GEX_Sample_688<-SoupChannel(raw.matrix_949_GEX_Sample_688, filt.matrix_949_GEX_Sample_688)
soup.channel_949_GEX_Sample_688
srat_949_GEX_Sample_688 <- NormalizeData(srat_949_GEX_Sample_688, normalization.method = "LogNormalize", scale.factor = 10000)

srat_949_GEX_Sample_688 <- FindVariableFeatures(srat_949_GEX_Sample_688, selection.method = "vst", nfeatures = 2000)
srat_949_GEX_Sample_688 <- ScaleData(srat_949_GEX_Sample_688)
srat_949_GEX_Sample_688 <- RunPCA(srat_949_GEX_Sample_688, verbose = F)
srat_949_GEX_Sample_688 <- RunUMAP(srat_949_GEX_Sample_688, dims = 1:15, verbose = F)
srat_949_GEX_Sample_688 <- FindNeighbors(srat_949_GEX_Sample_688, dims = 1:15, verbose = F)
srat_949_GEX_Sample_688 <- FindClusters(srat_949_GEX_Sample_688, verbose = T)

meta_949_GEX_Sample_688    <- srat_949_GEX_Sample_688@meta.data
umap_949_GEX_Sample_688    <- srat_949_GEX_Sample_688@reductions$umap@cell.embeddings
soup.channel_949_GEX_Sample_688  <- setClusters(soup.channel_949_GEX_Sample_688, setNames(meta_949_GEX_Sample_688$seurat_clusters, rownames(meta_949_GEX_Sample_688)))

soup.channel_949_GEX_Sample_688  <- setDR(soup.channel_949_GEX_Sample_688, umap_949_GEX_Sample_688)
head(meta_949_GEX_Sample_688)
soup.channel_949_GEX_Sample_688 <- autoEstCont(soup.channel_949_GEX_Sample_688)
head(soup.channel_949_GEX_Sample_688$soupProfile[order(soup.channel_949_GEX_Sample_688$soupProfile$est, decreasing = T), ], n = 20)

out_949_GEX_Sample_688 = adjustCounts(soup.channel_949_GEX_Sample_688)

#Sample 35

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/950_GEX_Sample_700")
filt.matrix_950_GEX_Sample_700<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_950_GEX_Sample_700<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_950_GEX_Sample_700)
str(filt.matrix_950_GEX_Sample_700)
srat_950_GEX_Sample_700<-CreateSeuratObject(counts=filt.matrix_950_GEX_Sample_700)
950_GEX_Sample_700
soup.channel_950_GEX_Sample_700<-SoupChannel(raw.matrix_950_GEX_Sample_700, filt.matrix_950_GEX_Sample_700)
soup.channel_950_GEX_Sample_700
srat_950_GEX_Sample_700 <- NormalizeData(srat_950_GEX_Sample_700, normalization.method = "LogNormalize", scale.factor = 10000)

srat_950_GEX_Sample_700 <- FindVariableFeatures(srat_950_GEX_Sample_700, selection.method = "vst", nfeatures = 2000)
srat_950_GEX_Sample_700 <- ScaleData(srat_950_GEX_Sample_700)
srat_950_GEX_Sample_700 <- RunPCA(srat_950_GEX_Sample_700, verbose = F)
srat_950_GEX_Sample_700 <- RunUMAP(srat_950_GEX_Sample_700, dims = 1:15, verbose = F)
srat_950_GEX_Sample_700 <- FindNeighbors(srat_950_GEX_Sample_700, dims = 1:15, verbose = F)
srat_950_GEX_Sample_700 <- FindClusters(srat_950_GEX_Sample_700, verbose = T)

meta_950_GEX_Sample_700    <- srat_950_GEX_Sample_700@meta.data
umap_950_GEX_Sample_700    <- srat_950_GEX_Sample_700@reductions$umap@cell.embeddings
soup.channel_950_GEX_Sample_700  <- setClusters(soup.channel_950_GEX_Sample_700, setNames(meta_950_GEX_Sample_700$seurat_clusters, rownames(meta_950_GEX_Sample_700)))

soup.channel_950_GEX_Sample_700  <- setDR(soup.channel_950_GEX_Sample_700, umap_950_GEX_Sample_700)
head(meta_950_GEX_Sample_700)
soup.channel_950_GEX_Sample_700 <- autoEstCont(soup.channel_950_GEX_Sample_700)
head(soup.channel_950_GEX_Sample_700$soupProfile[order(soup.channel_950_GEX_Sample_700$soupProfile$est, decreasing = T), ], n = 20)

out_950_GEX_Sample_700 = adjustCounts(soup.channel_950_GEX_Sample_700)

#Sample 36

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/951_GEX_Sample_97")
filt.matrix_951_GEX_Sample_97<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_951_GEX_Sample_97<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_951_GEX_Sample_97)
str(filt.matrix_951_GEX_Sample_97)
srat_951_GEX_Sample_97<-CreateSeuratObject(counts=filt.matrix_951_GEX_Sample_97)
951_GEX_Sample_97
soup.channel_951_GEX_Sample_97<-SoupChannel(raw.matrix_951_GEX_Sample_97, filt.matrix_951_GEX_Sample_97)
soup.channel_951_GEX_Sample_97
srat_951_GEX_Sample_97 <- NormalizeData(srat_951_GEX_Sample_97, normalization.method = "LogNormalize", scale.factor = 10000)

srat_951_GEX_Sample_97 <- FindVariableFeatures(srat_951_GEX_Sample_97, selection.method = "vst", nfeatures = 2000)
srat_951_GEX_Sample_97 <- ScaleData(srat_951_GEX_Sample_97)
srat_951_GEX_Sample_97 <- RunPCA(srat_951_GEX_Sample_97, verbose = F)
srat_951_GEX_Sample_97 <- RunUMAP(srat_951_GEX_Sample_97, dims = 1:15, verbose = F)
srat_951_GEX_Sample_97 <- FindNeighbors(srat_951_GEX_Sample_97, dims = 1:15, verbose = F)
srat_951_GEX_Sample_97 <- FindClusters(srat_951_GEX_Sample_97, verbose = T)

meta_951_GEX_Sample_97    <- srat_951_GEX_Sample_97@meta.data
umap_951_GEX_Sample_97    <- srat_951_GEX_Sample_97@reductions$umap@cell.embeddings
soup.channel_951_GEX_Sample_97  <- setClusters(soup.channel_951_GEX_Sample_97, setNames(meta_951_GEX_Sample_97$seurat_clusters, rownames(meta_951_GEX_Sample_97)))

soup.channel_951_GEX_Sample_97  <- setDR(soup.channel_951_GEX_Sample_97, umap_951_GEX_Sample_97)
head(meta_951_GEX_Sample_97)
soup.channel_951_GEX_Sample_97 <- autoEstCont(soup.channel_951_GEX_Sample_97)
head(soup.channel_951_GEX_Sample_97$soupProfile[order(soup.channel_951_GEX_Sample_97$soupProfile$est, decreasing = T), ], n = 20)

out_951_GEX_Sample_97 = adjustCounts(soup.channel_951_GEX_Sample_97)

#Sample 37

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/952_GEX_Sample_182")
filt.matrix_952_GEX_Sample_182<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_952_GEX_Sample_182<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_952_GEX_Sample_182)
str(filt.matrix_952_GEX_Sample_182)
srat_952_GEX_Sample_182<-CreateSeuratObject(counts=filt.matrix_952_GEX_Sample_182)
952_GEX_Sample_182
soup.channel_952_GEX_Sample_182<-SoupChannel(raw.matrix_952_GEX_Sample_182, filt.matrix_952_GEX_Sample_182)
soup.channel_952_GEX_Sample_182
srat_952_GEX_Sample_182 <- NormalizeData(srat_952_GEX_Sample_182, normalization.method = "LogNormalize", scale.factor = 10000)

srat_952_GEX_Sample_182 <- FindVariableFeatures(srat_952_GEX_Sample_182, selection.method = "vst", nfeatures = 2000)
srat_952_GEX_Sample_182 <- ScaleData(srat_952_GEX_Sample_182)
srat_952_GEX_Sample_182 <- RunPCA(srat_952_GEX_Sample_182, verbose = F)
srat_952_GEX_Sample_182 <- RunUMAP(srat_952_GEX_Sample_182, dims = 1:15, verbose = F)
srat_952_GEX_Sample_182 <- FindNeighbors(srat_952_GEX_Sample_182, dims = 1:15, verbose = F)
srat_952_GEX_Sample_182 <- FindClusters(srat_952_GEX_Sample_182, verbose = T)

meta_952_GEX_Sample_182    <- srat_952_GEX_Sample_182@meta.data
umap_952_GEX_Sample_182    <- srat_952_GEX_Sample_182@reductions$umap@cell.embeddings
soup.channel_952_GEX_Sample_182  <- setClusters(soup.channel_952_GEX_Sample_182, setNames(meta_952_GEX_Sample_182$seurat_clusters, rownames(meta_952_GEX_Sample_182)))

soup.channel_952_GEX_Sample_182  <- setDR(soup.channel_952_GEX_Sample_182, umap_952_GEX_Sample_182)
head(meta_952_GEX_Sample_182)
soup.channel_952_GEX_Sample_182 <- autoEstCont(soup.channel_952_GEX_Sample_182)
head(soup.channel_952_GEX_Sample_182$soupProfile[order(soup.channel_952_GEX_Sample_182$soupProfile$est, decreasing = T), ], n = 20)

out_952_GEX_Sample_182 = adjustCounts(soup.channel_952_GEX_Sample_182)

#Sample 38

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/953_GEX_Sample_243")
filt.matrix_953_GEX_Sample_243<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_953_GEX_Sample_243<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_953_GEX_Sample_243)
str(filt.matrix_953_GEX_Sample_243)
srat_953_GEX_Sample_243<-CreateSeuratObject(counts=filt.matrix_953_GEX_Sample_243)
953_GEX_Sample_243
soup.channel_953_GEX_Sample_243<-SoupChannel(raw.matrix_953_GEX_Sample_243, filt.matrix_953_GEX_Sample_243)
soup.channel_953_GEX_Sample_243
srat_953_GEX_Sample_243 <- NormalizeData(srat_953_GEX_Sample_243, normalization.method = "LogNormalize", scale.factor = 10000)

srat_953_GEX_Sample_243 <- FindVariableFeatures(srat_953_GEX_Sample_243, selection.method = "vst", nfeatures = 2000)
srat_953_GEX_Sample_243 <- ScaleData(srat_953_GEX_Sample_243)
srat_953_GEX_Sample_243 <- RunPCA(srat_953_GEX_Sample_243, verbose = F)
srat_953_GEX_Sample_243 <- RunUMAP(srat_953_GEX_Sample_243, dims = 1:15, verbose = F)
srat_953_GEX_Sample_243 <- FindNeighbors(srat_953_GEX_Sample_243, dims = 1:15, verbose = F)
srat_953_GEX_Sample_243 <- FindClusters(srat_953_GEX_Sample_243, verbose = T)

meta_953_GEX_Sample_243    <- srat_953_GEX_Sample_243@meta.data
umap_953_GEX_Sample_243    <- srat_953_GEX_Sample_243@reductions$umap@cell.embeddings
soup.channel_953_GEX_Sample_243  <- setClusters(soup.channel_953_GEX_Sample_243, setNames(meta_953_GEX_Sample_243$seurat_clusters, rownames(meta_953_GEX_Sample_243)))

soup.channel_953_GEX_Sample_243  <- setDR(soup.channel_953_GEX_Sample_243, umap_953_GEX_Sample_243)
head(meta_953_GEX_Sample_243)
soup.channel_953_GEX_Sample_243 <- autoEstCont(soup.channel_953_GEX_Sample_243)
head(soup.channel_953_GEX_Sample_243$soupProfile[order(soup.channel_953_GEX_Sample_243$soupProfile$est, decreasing = T), ], n = 20)

out_953_GEX_Sample_243 = adjustCounts(soup.channel_953_GEX_Sample_243)

#Sample 39

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/954_GEX_Sample_727")
filt.matrix_954_GEX_Sample_727<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_954_GEX_Sample_727<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_954_GEX_Sample_727)
str(filt.matrix_954_GEX_Sample_727)
srat_954_GEX_Sample_727<-CreateSeuratObject(counts=filt.matrix_954_GEX_Sample_727)
954_GEX_Sample_727
soup.channel_954_GEX_Sample_727<-SoupChannel(raw.matrix_954_GEX_Sample_727, filt.matrix_954_GEX_Sample_727)
soup.channel_954_GEX_Sample_727
srat_954_GEX_Sample_727 <- NormalizeData(srat_954_GEX_Sample_727, normalization.method = "LogNormalize", scale.factor = 10000)

srat_954_GEX_Sample_727 <- FindVariableFeatures(srat_954_GEX_Sample_727, selection.method = "vst", nfeatures = 2000)
srat_954_GEX_Sample_727 <- ScaleData(srat_954_GEX_Sample_727)
srat_954_GEX_Sample_727 <- RunPCA(srat_954_GEX_Sample_727, verbose = F)
srat_954_GEX_Sample_727 <- RunUMAP(srat_954_GEX_Sample_727, dims = 1:15, verbose = F)
srat_954_GEX_Sample_727 <- FindNeighbors(srat_954_GEX_Sample_727, dims = 1:15, verbose = F)
srat_954_GEX_Sample_727 <- FindClusters(srat_954_GEX_Sample_727, verbose = T)

meta_954_GEX_Sample_727    <- srat_954_GEX_Sample_727@meta.data
umap_954_GEX_Sample_727    <- srat_954_GEX_Sample_727@reductions$umap@cell.embeddings
soup.channel_954_GEX_Sample_727  <- setClusters(soup.channel_954_GEX_Sample_727, setNames(meta_954_GEX_Sample_727$seurat_clusters, rownames(meta_954_GEX_Sample_727)))

soup.channel_954_GEX_Sample_727  <- setDR(soup.channel_954_GEX_Sample_727, umap_954_GEX_Sample_727)
head(meta_954_GEX_Sample_727)
soup.channel_954_GEX_Sample_727 <- autoEstCont(soup.channel_954_GEX_Sample_727)
head(soup.channel_954_GEX_Sample_727$soupProfile[order(soup.channel_954_GEX_Sample_727$soupProfile$est, decreasing = T), ], n = 20)

out_954_GEX_Sample_727 = adjustCounts(soup.channel_954_GEX_Sample_727)

#Sample 40

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/980_GEX_Sample_192")
filt.matrix_980_GEX_Sample_192<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_980_GEX_Sample_192<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_980_GEX_Sample_192)
str(filt.matrix_980_GEX_Sample_192)
srat_980_GEX_Sample_192<-CreateSeuratObject(counts=filt.matrix_980_GEX_Sample_192)
980_GEX_Sample_192
soup.channel_980_GEX_Sample_192<-SoupChannel(raw.matrix_980_GEX_Sample_192, filt.matrix_980_GEX_Sample_192)
soup.channel_980_GEX_Sample_192
srat_980_GEX_Sample_192 <- NormalizeData(srat_980_GEX_Sample_192, normalization.method = "LogNormalize", scale.factor = 10000)

srat_980_GEX_Sample_192 <- FindVariableFeatures(srat_980_GEX_Sample_192, selection.method = "vst", nfeatures = 2000)
srat_980_GEX_Sample_192 <- ScaleData(srat_980_GEX_Sample_192)
srat_980_GEX_Sample_192 <- RunPCA(srat_980_GEX_Sample_192, verbose = F)
srat_980_GEX_Sample_192 <- RunUMAP(srat_980_GEX_Sample_192, dims = 1:15, verbose = F)
srat_980_GEX_Sample_192 <- FindNeighbors(srat_980_GEX_Sample_192, dims = 1:15, verbose = F)
srat_980_GEX_Sample_192 <- FindClusters(srat_980_GEX_Sample_192, verbose = T)

meta_980_GEX_Sample_192    <- srat_980_GEX_Sample_192@meta.data
umap_980_GEX_Sample_192    <- srat_980_GEX_Sample_192@reductions$umap@cell.embeddings
soup.channel_980_GEX_Sample_192  <- setClusters(soup.channel_980_GEX_Sample_192, setNames(meta_980_GEX_Sample_192$seurat_clusters, rownames(meta_980_GEX_Sample_192)))

soup.channel_980_GEX_Sample_192  <- setDR(soup.channel_980_GEX_Sample_192, umap_980_GEX_Sample_192)
head(meta_980_GEX_Sample_192)
soup.channel_980_GEX_Sample_192 <- autoEstCont(soup.channel_980_GEX_Sample_192)
head(soup.channel_980_GEX_Sample_192$soupProfile[order(soup.channel_980_GEX_Sample_192$soupProfile$est, decreasing = T), ], n = 20)

out_980_GEX_Sample_192 = adjustCounts(soup.channel_980_GEX_Sample_192)

#Sample 41

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/981_GEX_Sample_228")
filt.matrix_981_GEX_Sample_228<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_981_GEX_Sample_228<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_981_GEX_Sample_228)
str(filt.matrix_981_GEX_Sample_228)
srat_981_GEX_Sample_228<-CreateSeuratObject(counts=filt.matrix_981_GEX_Sample_228)
981_GEX_Sample_228
soup.channel_981_GEX_Sample_228<-SoupChannel(raw.matrix_981_GEX_Sample_228, filt.matrix_981_GEX_Sample_228)
soup.channel_981_GEX_Sample_228
srat_981_GEX_Sample_228 <- NormalizeData(srat_981_GEX_Sample_228, normalization.method = "LogNormalize", scale.factor = 10000)

srat_981_GEX_Sample_228 <- FindVariableFeatures(srat_981_GEX_Sample_228, selection.method = "vst", nfeatures = 2000)
srat_981_GEX_Sample_228 <- ScaleData(srat_981_GEX_Sample_228)
srat_981_GEX_Sample_228 <- RunPCA(srat_981_GEX_Sample_228, verbose = F)
srat_981_GEX_Sample_228 <- RunUMAP(srat_981_GEX_Sample_228, dims = 1:15, verbose = F)
srat_981_GEX_Sample_228 <- FindNeighbors(srat_981_GEX_Sample_228, dims = 1:15, verbose = F)
srat_981_GEX_Sample_228 <- FindClusters(srat_981_GEX_Sample_228, verbose = T)

meta_981_GEX_Sample_228    <- srat_981_GEX_Sample_228@meta.data
umap_981_GEX_Sample_228    <- srat_981_GEX_Sample_228@reductions$umap@cell.embeddings
soup.channel_981_GEX_Sample_228  <- setClusters(soup.channel_981_GEX_Sample_228, setNames(meta_981_GEX_Sample_228$seurat_clusters, rownames(meta_981_GEX_Sample_228)))

soup.channel_981_GEX_Sample_228  <- setDR(soup.channel_981_GEX_Sample_228, umap_981_GEX_Sample_228)
head(meta_981_GEX_Sample_228)
soup.channel_981_GEX_Sample_228 <- autoEstCont(soup.channel_981_GEX_Sample_228)
head(soup.channel_981_GEX_Sample_228$soupProfile[order(soup.channel_981_GEX_Sample_228$soupProfile$est, decreasing = T), ], n = 20)

out_981_GEX_Sample_228 = adjustCounts(soup.channel_981_GEX_Sample_228)

#Sample 42

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/984_GEX_Sample_209")
filt.matrix_984_GEX_Sample_209<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_984_GEX_Sample_209<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_984_GEX_Sample_209)
str(filt.matrix_984_GEX_Sample_209)
srat_984_GEX_Sample_209<-CreateSeuratObject(counts=filt.matrix_984_GEX_Sample_209)
984_GEX_Sample_209
soup.channel_984_GEX_Sample_209<-SoupChannel(raw.matrix_984_GEX_Sample_209, filt.matrix_984_GEX_Sample_209)
soup.channel_984_GEX_Sample_209
srat_984_GEX_Sample_209 <- NormalizeData(srat_984_GEX_Sample_209, normalization.method = "LogNormalize", scale.factor = 10000)

srat_984_GEX_Sample_209 <- FindVariableFeatures(srat_984_GEX_Sample_209, selection.method = "vst", nfeatures = 2000)
srat_984_GEX_Sample_209 <- ScaleData(srat_984_GEX_Sample_209)
srat_984_GEX_Sample_209 <- RunPCA(srat_984_GEX_Sample_209, verbose = F)
srat_984_GEX_Sample_209 <- RunUMAP(srat_984_GEX_Sample_209, dims = 1:15, verbose = F)
srat_984_GEX_Sample_209 <- FindNeighbors(srat_984_GEX_Sample_209, dims = 1:15, verbose = F)
srat_984_GEX_Sample_209 <- FindClusters(srat_984_GEX_Sample_209, verbose = T)

meta_984_GEX_Sample_209    <- srat_984_GEX_Sample_209@meta.data
umap_984_GEX_Sample_209    <- srat_984_GEX_Sample_209@reductions$umap@cell.embeddings
soup.channel_984_GEX_Sample_209  <- setClusters(soup.channel_984_GEX_Sample_209, setNames(meta_984_GEX_Sample_209$seurat_clusters, rownames(meta_984_GEX_Sample_209)))

soup.channel_984_GEX_Sample_209  <- setDR(soup.channel_984_GEX_Sample_209, umap_984_GEX_Sample_209)
head(meta_984_GEX_Sample_209)
soup.channel_984_GEX_Sample_209 <- autoEstCont(soup.channel_984_GEX_Sample_209)
head(soup.channel_984_GEX_Sample_209$soupProfile[order(soup.channel_984_GEX_Sample_209$soupProfile$est, decreasing = T), ], n = 20)

out_984_GEX_Sample_209 = adjustCounts(soup.channel_984_GEX_Sample_209)

#Sample 43

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/985_GEX_Sample_234")
filt.matrix_985_GEX_Sample_234<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_985_GEX_Sample_234<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_985_GEX_Sample_234)
str(filt.matrix_985_GEX_Sample_234)
srat_985_GEX_Sample_234<-CreateSeuratObject(counts=filt.matrix_985_GEX_Sample_234)
985_GEX_Sample_234
soup.channel_985_GEX_Sample_234<-SoupChannel(raw.matrix_985_GEX_Sample_234, filt.matrix_985_GEX_Sample_234)
soup.channel_985_GEX_Sample_234
srat_985_GEX_Sample_234 <- NormalizeData(srat_985_GEX_Sample_234, normalization.method = "LogNormalize", scale.factor = 10000)

srat_985_GEX_Sample_234 <- FindVariableFeatures(srat_985_GEX_Sample_234, selection.method = "vst", nfeatures = 2000)
srat_985_GEX_Sample_234 <- ScaleData(srat_985_GEX_Sample_234)
srat_985_GEX_Sample_234 <- RunPCA(srat_985_GEX_Sample_234, verbose = F)
srat_985_GEX_Sample_234 <- RunUMAP(srat_985_GEX_Sample_234, dims = 1:15, verbose = F)
srat_985_GEX_Sample_234 <- FindNeighbors(srat_985_GEX_Sample_234, dims = 1:15, verbose = F)
srat_985_GEX_Sample_234 <- FindClusters(srat_985_GEX_Sample_234, verbose = T)

meta_985_GEX_Sample_234    <- srat_985_GEX_Sample_234@meta.data
umap_985_GEX_Sample_234    <- srat_985_GEX_Sample_234@reductions$umap@cell.embeddings
soup.channel_985_GEX_Sample_234  <- setClusters(soup.channel_985_GEX_Sample_234, setNames(meta_985_GEX_Sample_234$seurat_clusters, rownames(meta_985_GEX_Sample_234)))

soup.channel_985_GEX_Sample_234  <- setDR(soup.channel_985_GEX_Sample_234, umap_985_GEX_Sample_234)
head(meta_985_GEX_Sample_234)
soup.channel_985_GEX_Sample_234 <- autoEstCont(soup.channel_985_GEX_Sample_234)
head(soup.channel_985_GEX_Sample_234$soupProfile[order(soup.channel_985_GEX_Sample_234$soupProfile$est, decreasing = T), ], n = 20)

out_985_GEX_Sample_234 = adjustCounts(soup.channel_985_GEX_Sample_234)

#Sample 44

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/986_GEX_Sample_252")
filt.matrix_986_GEX_Sample_252<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_986_GEX_Sample_252<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_986_GEX_Sample_252)
str(filt.matrix_986_GEX_Sample_252)
srat_986_GEX_Sample_252<-CreateSeuratObject(counts=filt.matrix_986_GEX_Sample_252)
986_GEX_Sample_252
soup.channel_986_GEX_Sample_252<-SoupChannel(raw.matrix_986_GEX_Sample_252, filt.matrix_986_GEX_Sample_252)
soup.channel_986_GEX_Sample_252
srat_986_GEX_Sample_252 <- NormalizeData(srat_986_GEX_Sample_252, normalization.method = "LogNormalize", scale.factor = 10000)

srat_986_GEX_Sample_252 <- FindVariableFeatures(srat_986_GEX_Sample_252, selection.method = "vst", nfeatures = 2000)
srat_986_GEX_Sample_252 <- ScaleData(srat_986_GEX_Sample_252)
srat_986_GEX_Sample_252 <- RunPCA(srat_986_GEX_Sample_252, verbose = F)
srat_986_GEX_Sample_252 <- RunUMAP(srat_986_GEX_Sample_252, dims = 1:15, verbose = F)
srat_986_GEX_Sample_252 <- FindNeighbors(srat_986_GEX_Sample_252, dims = 1:15, verbose = F)
srat_986_GEX_Sample_252 <- FindClusters(srat_986_GEX_Sample_252, verbose = T)

meta_986_GEX_Sample_252    <- srat_986_GEX_Sample_252@meta.data
umap_986_GEX_Sample_252    <- srat_986_GEX_Sample_252@reductions$umap@cell.embeddings
soup.channel_986_GEX_Sample_252  <- setClusters(soup.channel_986_GEX_Sample_252, setNames(meta_986_GEX_Sample_252$seurat_clusters, rownames(meta_986_GEX_Sample_252)))

soup.channel_986_GEX_Sample_252  <- setDR(soup.channel_986_GEX_Sample_252, umap_986_GEX_Sample_252)
head(meta_986_GEX_Sample_252)
soup.channel_986_GEX_Sample_252 <- autoEstCont(soup.channel_986_GEX_Sample_252)
head(soup.channel_986_GEX_Sample_252$soupProfile[order(soup.channel_986_GEX_Sample_252$soupProfile$est, decreasing = T), ], n = 20)

out_986_GEX_Sample_252 = adjustCounts(soup.channel_986_GEX_Sample_252)

#Sample 45

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/987_GEX_Sample_253")
filt.matrix_987_GEX_Sample_253<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_987_GEX_Sample_253<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_987_GEX_Sample_253)
str(filt.matrix_987_GEX_Sample_253)
srat_987_GEX_Sample_253<-CreateSeuratObject(counts=filt.matrix_987_GEX_Sample_253)
987_GEX_Sample_253
soup.channel_987_GEX_Sample_253<-SoupChannel(raw.matrix_987_GEX_Sample_253, filt.matrix_987_GEX_Sample_253)
soup.channel_987_GEX_Sample_253
srat_987_GEX_Sample_253 <- NormalizeData(srat_987_GEX_Sample_253, normalization.method = "LogNormalize", scale.factor = 10000)

srat_987_GEX_Sample_253 <- FindVariableFeatures(srat_987_GEX_Sample_253, selection.method = "vst", nfeatures = 2000)
srat_987_GEX_Sample_253 <- ScaleData(srat_987_GEX_Sample_253)
srat_987_GEX_Sample_253 <- RunPCA(srat_987_GEX_Sample_253, verbose = F)
srat_987_GEX_Sample_253 <- RunUMAP(srat_987_GEX_Sample_253, dims = 1:15, verbose = F)
srat_987_GEX_Sample_253 <- FindNeighbors(srat_987_GEX_Sample_253, dims = 1:15, verbose = F)
srat_987_GEX_Sample_253 <- FindClusters(srat_987_GEX_Sample_253, verbose = T)

meta_987_GEX_Sample_253    <- srat_987_GEX_Sample_253@meta.data
umap_987_GEX_Sample_253    <- srat_987_GEX_Sample_253@reductions$umap@cell.embeddings
soup.channel_987_GEX_Sample_253  <- setClusters(soup.channel_987_GEX_Sample_253, setNames(meta_987_GEX_Sample_253$seurat_clusters, rownames(meta_987_GEX_Sample_253)))

soup.channel_987_GEX_Sample_253  <- setDR(soup.channel_987_GEX_Sample_253, umap_987_GEX_Sample_253)
head(meta_987_GEX_Sample_253)
soup.channel_987_GEX_Sample_253 <- autoEstCont(soup.channel_987_GEX_Sample_253)
head(soup.channel_987_GEX_Sample_253$soupProfile[order(soup.channel_987_GEX_Sample_253$soupProfile$est, decreasing = T), ], n = 20)

out_987_GEX_Sample_253 = adjustCounts(soup.channel_987_GEX_Sample_253)

#Sample 46

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/996_GEX_Sample_315")
filt.matrix_996_GEX_Sample_315<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_996_GEX_Sample_315<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_996_GEX_Sample_315)
str(filt.matrix_996_GEX_Sample_315)
srat_996_GEX_Sample_315<-CreateSeuratObject(counts=filt.matrix_996_GEX_Sample_315)
996_GEX_Sample_315
soup.channel_996_GEX_Sample_315<-SoupChannel(raw.matrix_996_GEX_Sample_315, filt.matrix_996_GEX_Sample_315)
soup.channel_996_GEX_Sample_315
srat_996_GEX_Sample_315 <- NormalizeData(srat_996_GEX_Sample_315, normalization.method = "LogNormalize", scale.factor = 10000)

srat_996_GEX_Sample_315 <- FindVariableFeatures(srat_996_GEX_Sample_315, selection.method = "vst", nfeatures = 2000)
srat_996_GEX_Sample_315 <- ScaleData(srat_996_GEX_Sample_315)
srat_996_GEX_Sample_315 <- RunPCA(srat_996_GEX_Sample_315, verbose = F)
srat_996_GEX_Sample_315 <- RunUMAP(srat_996_GEX_Sample_315, dims = 1:15, verbose = F)
srat_996_GEX_Sample_315 <- FindNeighbors(srat_996_GEX_Sample_315, dims = 1:15, verbose = F)
srat_996_GEX_Sample_315 <- FindClusters(srat_996_GEX_Sample_315, verbose = T)

meta_996_GEX_Sample_315    <- srat_996_GEX_Sample_315@meta.data
umap_996_GEX_Sample_315    <- srat_996_GEX_Sample_315@reductions$umap@cell.embeddings
soup.channel_996_GEX_Sample_315  <- setClusters(soup.channel_996_GEX_Sample_315, setNames(meta_996_GEX_Sample_315$seurat_clusters, rownames(meta_996_GEX_Sample_315)))

soup.channel_996_GEX_Sample_315  <- setDR(soup.channel_996_GEX_Sample_315, umap_996_GEX_Sample_315)
head(meta_996_GEX_Sample_315)
soup.channel_996_GEX_Sample_315 <- autoEstCont(soup.channel_996_GEX_Sample_315)
head(soup.channel_996_GEX_Sample_315$soupProfile[order(soup.channel_996_GEX_Sample_315$soupProfile$est, decreasing = T), ], n = 20)

out_996_GEX_Sample_315 = adjustCounts(soup.channel_996_GEX_Sample_315)

#Sample 47

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/997_GEX_Sample_330")
filt.matrix_997_GEX_Sample_330<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_997_GEX_Sample_330<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_997_GEX_Sample_330)
str(filt.matrix_997_GEX_Sample_330)
srat_997_GEX_Sample_330<-CreateSeuratObject(counts=filt.matrix_997_GEX_Sample_330)
997_GEX_Sample_330
soup.channel_997_GEX_Sample_330<-SoupChannel(raw.matrix_997_GEX_Sample_330, filt.matrix_997_GEX_Sample_330)
soup.channel_997_GEX_Sample_330
srat_997_GEX_Sample_330 <- NormalizeData(srat_997_GEX_Sample_330, normalization.method = "LogNormalize", scale.factor = 10000)

srat_997_GEX_Sample_330 <- FindVariableFeatures(srat_997_GEX_Sample_330, selection.method = "vst", nfeatures = 2000)
srat_997_GEX_Sample_330 <- ScaleData(srat_997_GEX_Sample_330)
srat_997_GEX_Sample_330 <- RunPCA(srat_997_GEX_Sample_330, verbose = F)
srat_997_GEX_Sample_330 <- RunUMAP(srat_997_GEX_Sample_330, dims = 1:15, verbose = F)
srat_997_GEX_Sample_330 <- FindNeighbors(srat_997_GEX_Sample_330, dims = 1:15, verbose = F)
srat_997_GEX_Sample_330 <- FindClusters(srat_997_GEX_Sample_330, verbose = T)

meta_997_GEX_Sample_330    <- srat_997_GEX_Sample_330@meta.data
umap_997_GEX_Sample_330    <- srat_997_GEX_Sample_330@reductions$umap@cell.embeddings
soup.channel_997_GEX_Sample_330  <- setClusters(soup.channel_997_GEX_Sample_330, setNames(meta_997_GEX_Sample_330$seurat_clusters, rownames(meta_997_GEX_Sample_330)))

soup.channel_997_GEX_Sample_330  <- setDR(soup.channel_997_GEX_Sample_330, umap_997_GEX_Sample_330)
head(meta_997_GEX_Sample_330)
soup.channel_997_GEX_Sample_330 <- autoEstCont(soup.channel_997_GEX_Sample_330)
head(soup.channel_997_GEX_Sample_330$soupProfile[order(soup.channel_997_GEX_Sample_330$soupProfile$est, decreasing = T), ], n = 20)

out_997_GEX_Sample_330 = adjustCounts(soup.channel_997_GEX_Sample_330)

#Sample 48

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/998_GEX_Sample_332")
filt.matrix_998_GEX_Sample_332<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_998_GEX_Sample_332<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_998_GEX_Sample_332)
str(filt.matrix_998_GEX_Sample_332)
srat_998_GEX_Sample_332<-CreateSeuratObject(counts=filt.matrix_998_GEX_Sample_332)
998_GEX_Sample_332
soup.channel_998_GEX_Sample_332<-SoupChannel(raw.matrix_998_GEX_Sample_332, filt.matrix_998_GEX_Sample_332)
soup.channel_998_GEX_Sample_332
srat_998_GEX_Sample_332 <- NormalizeData(srat_998_GEX_Sample_332, normalization.method = "LogNormalize", scale.factor = 10000)

srat_998_GEX_Sample_332 <- FindVariableFeatures(srat_998_GEX_Sample_332, selection.method = "vst", nfeatures = 2000)
srat_998_GEX_Sample_332 <- ScaleData(srat_998_GEX_Sample_332)
srat_998_GEX_Sample_332 <- RunPCA(srat_998_GEX_Sample_332, verbose = F)
srat_998_GEX_Sample_332 <- RunUMAP(srat_998_GEX_Sample_332, dims = 1:15, verbose = F)
srat_998_GEX_Sample_332 <- FindNeighbors(srat_998_GEX_Sample_332, dims = 1:15, verbose = F)
srat_998_GEX_Sample_332 <- FindClusters(srat_998_GEX_Sample_332, verbose = T)

meta_998_GEX_Sample_332    <- srat_998_GEX_Sample_332@meta.data
umap_998_GEX_Sample_332    <- srat_998_GEX_Sample_332@reductions$umap@cell.embeddings
soup.channel_998_GEX_Sample_332  <- setClusters(soup.channel_998_GEX_Sample_332, setNames(meta_998_GEX_Sample_332$seurat_clusters, rownames(meta_998_GEX_Sample_332)))

soup.channel_998_GEX_Sample_332  <- setDR(soup.channel_998_GEX_Sample_332, umap_998_GEX_Sample_332)
head(meta_998_GEX_Sample_332)
soup.channel_998_GEX_Sample_332 <- autoEstCont(soup.channel_998_GEX_Sample_332)
head(soup.channel_998_GEX_Sample_332$soupProfile[order(soup.channel_998_GEX_Sample_332$soupProfile$est, decreasing = T), ], n = 20)

out_998_GEX_Sample_332 = adjustCounts(soup.channel_998_GEX_Sample_332)

#Sample 49

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/999_GEX_Sample_367")
filt.matrix_999_GEX_Sample_367<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_999_GEX_Sample_367<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_999_GEX_Sample_367)
str(filt.matrix_999_GEX_Sample_367)
srat_999_GEX_Sample_367<-CreateSeuratObject(counts=filt.matrix_999_GEX_Sample_367)
999_GEX_Sample_367
soup.channel_999_GEX_Sample_367<-SoupChannel(raw.matrix_999_GEX_Sample_367, filt.matrix_999_GEX_Sample_367)
soup.channel_999_GEX_Sample_367
srat_999_GEX_Sample_367 <- NormalizeData(srat_999_GEX_Sample_367, normalization.method = "LogNormalize", scale.factor = 10000)

srat_999_GEX_Sample_367 <- FindVariableFeatures(srat_999_GEX_Sample_367, selection.method = "vst", nfeatures = 2000)
srat_999_GEX_Sample_367 <- ScaleData(srat_999_GEX_Sample_367)
srat_999_GEX_Sample_367 <- RunPCA(srat_999_GEX_Sample_367, verbose = F)
srat_999_GEX_Sample_367 <- RunUMAP(srat_999_GEX_Sample_367, dims = 1:15, verbose = F)
srat_999_GEX_Sample_367 <- FindNeighbors(srat_999_GEX_Sample_367, dims = 1:15, verbose = F)
srat_999_GEX_Sample_367 <- FindClusters(srat_999_GEX_Sample_367, verbose = T)

meta_999_GEX_Sample_367    <- srat_999_GEX_Sample_367@meta.data
umap_999_GEX_Sample_367    <- srat_999_GEX_Sample_367@reductions$umap@cell.embeddings
soup.channel_999_GEX_Sample_367  <- setClusters(soup.channel_999_GEX_Sample_367, setNames(meta_999_GEX_Sample_367$seurat_clusters, rownames(meta_999_GEX_Sample_367)))

soup.channel_999_GEX_Sample_367  <- setDR(soup.channel_999_GEX_Sample_367, umap_999_GEX_Sample_367)
head(meta_999_GEX_Sample_367)
soup.channel_999_GEX_Sample_367 <- autoEstCont(soup.channel_999_GEX_Sample_367)
head(soup.channel_999_GEX_Sample_367$soupProfile[order(soup.channel_999_GEX_Sample_367$soupProfile$est, decreasing = T), ], n = 20)

out_999_GEX_Sample_367 = adjustCounts(soup.channel_999_GEX_Sample_367)

#Sample 50

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_01_286")
filt.matrix_Alcohol_01_286<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_01_286<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_01_286)
str(filt.matrix_Alcohol_01_286)
srat_Alcohol_01_286<-CreateSeuratObject(counts=filt.matrix_Alcohol_01_286)
Alcohol_01_286
soup.channel_Alcohol_01_286<-SoupChannel(raw.matrix_Alcohol_01_286, filt.matrix_Alcohol_01_286)
soup.channel_Alcohol_01_286
srat_Alcohol_01_286 <- NormalizeData(srat_Alcohol_01_286, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_01_286 <- FindVariableFeatures(srat_Alcohol_01_286, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_01_286 <- ScaleData(srat_Alcohol_01_286)
srat_Alcohol_01_286 <- RunPCA(srat_Alcohol_01_286, verbose = F)
srat_Alcohol_01_286 <- RunUMAP(srat_Alcohol_01_286, dims = 1:15, verbose = F)
srat_Alcohol_01_286 <- FindNeighbors(srat_Alcohol_01_286, dims = 1:15, verbose = F)
srat_Alcohol_01_286 <- FindClusters(srat_Alcohol_01_286, verbose = T)

meta_Alcohol_01_286    <- srat_Alcohol_01_286@meta.data
umap_Alcohol_01_286    <- srat_Alcohol_01_286@reductions$umap@cell.embeddings
soup.channel_Alcohol_01_286  <- setClusters(soup.channel_Alcohol_01_286, setNames(meta_Alcohol_01_286$seurat_clusters, rownames(meta_Alcohol_01_286)))

soup.channel_Alcohol_01_286  <- setDR(soup.channel_Alcohol_01_286, umap_Alcohol_01_286)
head(meta_Alcohol_01_286)
soup.channel_Alcohol_01_286 <- autoEstCont(soup.channel_Alcohol_01_286)
head(soup.channel_Alcohol_01_286$soupProfile[order(soup.channel_Alcohol_01_286$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_01_286 = adjustCounts(soup.channel_Alcohol_01_286)

#Sample 51

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_02_508")
filt.matrix_Alcohol_02_508<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_02_508<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_02_508)
str(filt.matrix_Alcohol_02_508)
srat_Alcohol_02_508<-CreateSeuratObject(counts=filt.matrix_Alcohol_02_508)
Alcohol_02_508
soup.channel_Alcohol_02_508<-SoupChannel(raw.matrix_Alcohol_02_508, filt.matrix_Alcohol_02_508)
soup.channel_Alcohol_02_508
srat_Alcohol_02_508<- NormalizeData(srat_Alcohol_02_508, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_02_508<- FindVariableFeatures(srat_Alcohol_02_508, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_02_508<- ScaleData(srat_Alcohol_02_508)
srat_Alcohol_02_508<- RunPCA(srat_Alcohol_02_508, verbose = F)
srat_Alcohol_02_508<- RunUMAP(srat_Alcohol_02_508, dims = 1:15, verbose = F)
srat_Alcohol_02_508<- FindNeighbors(srat_Alcohol_02_508, dims = 1:15, verbose = F)
srat_Alcohol_02_508<- FindClusters(srat_Alcohol_02_508, verbose = T)

meta_Alcohol_02_508<- srat_Alcohol_02_508@meta.data
umap_Alcohol_02_508<- srat_Alcohol_02_508@reductions$umap@cell.embeddings
soup.channel_Alcohol_02_508<- setClusters(soup.channel_Alcohol_02_508, setNames(meta_Alcohol_02_508$seurat_clusters, rownames(meta_Alcohol_02_508)))

soup.channel_Alcohol_02_508<- setDR(soup.channel_Alcohol_02_508, umap_Alcohol_02_508)
head(meta_Alcohol_02_508)
soup.channel_Alcohol_02_508<- autoEstCont(soup.channel_Alcohol_02_508)
head(soup.channel_Alcohol_02_508$soupProfile[order(soup.channel_Alcohol_02_508$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_02_508 = adjustCounts(soup.channel_Alcohol_02_508)

#Sample 52

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_05_652 ")
filt.matrix_Alcohol_05_652 <-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_05_652 <-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_05_652)
str(filt.matrix_Alcohol_05_652)
srat_Alcohol_05_652<-CreateSeuratObject(counts=filt.matrix_Alcohol_05_652)
Alcohol_05_652 
soup.channel_Alcohol_05_652<-SoupChannel(raw.matrix_Alcohol_05_652, filt.matrix_Alcohol_05_652)
soup.channel_Alcohol_05_652 
srat_Alcohol_05_652<- NormalizeData(srat_Alcohol_05_652, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_05_652<- FindVariableFeatures(srat_Alcohol_05_652, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_05_652<- ScaleData(srat_Alcohol_05_652)
srat_Alcohol_05_652<- RunPCA(srat_Alcohol_05_652, verbose = F)
srat_Alcohol_05_652<- RunUMAP(srat_Alcohol_05_652, dims = 1:15, verbose = F)
srat_Alcohol_05_652<- FindNeighbors(srat_Alcohol_05_652, dims = 1:15, verbose = F)
srat_Alcohol_05_652<- FindClusters(srat_Alcohol_05_652, verbose = T)

meta_Alcohol_05_652<- srat_Alcohol_05_652@meta.data
umap_Alcohol_05_652<- srat_Alcohol_05_652@reductions$umap@cell.embeddings
soup.channel_Alcohol_05_652<- setClusters(soup.channel_Alcohol_05_652, setNames(meta_Alcohol_05_652$seurat_clusters, rownames(meta_Alcohol_05_652)))

soup.channel_Alcohol_05_652<- setDR(soup.channel_Alcohol_05_652, umap_Alcohol_05_652)
head(meta_Alcohol_05_652)
soup.channel_Alcohol_05_652<- autoEstCont(soup.channel_Alcohol_05_652)
head(soup.channel_Alcohol_05_652$soupProfile[order(soup.channel_Alcohol_05_652$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_05_652 = adjustCounts(soup.channel_Alcohol_05_652)

#Sample 53

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_06_695 ")
filt.matrix_Alcohol_06_695 <-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_06_695 <-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_06_695)
str(filt.matrix_Alcohol_06_695)
srat_Alcohol_06_695<-CreateSeuratObject(counts=filt.matrix_Alcohol_06_695)
Alcohol_06_695 
soup.channel_Alcohol_06_695<-SoupChannel(raw.matrix_Alcohol_06_695, filt.matrix_Alcohol_06_695)
soup.channel_Alcohol_06_695
srat_Alcohol_06_695<- NormalizeData(srat_Alcohol_06_695, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_06_695<- FindVariableFeatures(srat_Alcohol_06_695, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_06_695<- ScaleData(srat_Alcohol_06_695)
srat_Alcohol_06_695<- RunPCA(srat_Alcohol_06_695, verbose = F)
srat_Alcohol_06_695<- RunUMAP(srat_Alcohol_06_695, dims = 1:15, verbose = F)
srat_Alcohol_06_695<- FindNeighbors(srat_Alcohol_06_695, dims = 1:15, verbose = F)
srat_Alcohol_06_695<- FindClusters(srat_Alcohol_06_695, verbose = T)

meta_Alcohol_06_695<- srat_Alcohol_06_695@meta.data
umap_Alcohol_06_695<- srat_Alcohol_06_695@reductions$umap@cell.embeddings
soup.channel_Alcohol_06_695<- setClusters(soup.channel_Alcohol_06_695, setNames(meta_Alcohol_06_695$seurat_clusters, rownames(meta_Alcohol_06_695)))

soup.channel_Alcohol_06_695<- setDR(soup.channel_Alcohol_06_695, umap_Alcohol_06_695)
head(meta_Alcohol_06_695)
soup.channel_Alcohol_06_695<- autoEstCont(soup.channel_Alcohol_06_695)
head(soup.channel_Alcohol_06_695$soupProfile[order(soup.channel_Alcohol_06_695$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_06_695 = adjustCounts(soup.channel_Alcohol_06_695)

#Sample 54

setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_11_767 ")
filt.matrix_Alcohol_11_767 <-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_11_767 <-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_11_767)
str(filt.matrix_Alcohol_11_767)
srat_Alcohol_11_767<-CreateSeuratObject(counts=filt.matrix_Alcohol_11_767)
Alcohol_11_767 
soup.channel_Alcohol_11_767<-SoupChannel(raw.matrix_Alcohol_11_767, filt.matrix_Alcohol_11_767)
soup.channel_Alcohol_11_767 
srat_Alcohol_11_767<- NormalizeData(srat_Alcohol_11_767, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_11_767<- FindVariableFeatures(srat_Alcohol_11_767, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_11_767<- ScaleData(srat_Alcohol_11_767)
srat_Alcohol_11_767<- RunPCA(srat_Alcohol_11_767, verbose = F)
srat_Alcohol_11_767<- RunUMAP(srat_Alcohol_11_767, dims = 1:15, verbose = F)
srat_Alcohol_11_767<- FindNeighbors(srat_Alcohol_11_767, dims = 1:15, verbose = F)
srat_Alcohol_11_767<- FindClusters(srat_Alcohol_11_767, verbose = T)

meta_Alcohol_11_767<- srat_Alcohol_11_767@meta.data
umap_Alcohol_11_767<- srat_Alcohol_11_767@reductions$umap@cell.embeddings
soup.channel_Alcohol_11_767<- setClusters(soup.channel_Alcohol_11_767, setNames(meta_Alcohol_11_767$seurat_clusters, rownames(meta_Alcohol_11_767)))

soup.channel_Alcohol_11_767<- setDR(soup.channel_Alcohol_11_767, umap_Alcohol_11_767)
head(meta_Alcohol_11_767)
soup.channel_Alcohol_11_767<- autoEstCont(soup.channel_Alcohol_11_767)
head(soup.channel_Alcohol_11_767 $soupProfile[order(soup.channel_Alcohol_11_767$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_11_767 = adjustCounts(soup.channel_Alcohol_11_767)

#Sample 55
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_16_800")
filt.matrix_Alcohol_16_800<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_16_800<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_16_800)
str(filt.matrix_Alcohol_16_800)
srat_Alcohol_16_800<-CreateSeuratObject(counts=filt.matrix_Alcohol_16_800)
Alcohol_16_800
soup.channel_Alcohol_16_800<-SoupChannel(raw.matrix_Alcohol_16_800, filt.matrix_Alcohol_16_800)
soup.channel_Alcohol_16_800
srat_Alcohol_16_800 <- NormalizeData(srat_Alcohol_16_800, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_16_800 <- FindVariableFeatures(srat_Alcohol_16_800, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_16_800 <- ScaleData(srat_Alcohol_16_800)
srat_Alcohol_16_800 <- RunPCA(srat_Alcohol_16_800, verbose = F)
srat_Alcohol_16_800 <- RunUMAP(srat_Alcohol_16_800, dims = 1:15, verbose = F)
srat_Alcohol_16_800 <- FindNeighbors(srat_Alcohol_16_800, dims = 1:15, verbose = F)
srat_Alcohol_16_800 <- FindClusters(srat_Alcohol_16_800, verbose = T)

meta_Alcohol_16_800    <- srat_Alcohol_16_800@meta.data
umap_Alcohol_16_800    <- srat_Alcohol_16_800@reductions$umap@cell.embeddings
soup.channel_Alcohol_16_800  <- setClusters(soup.channel_Alcohol_16_800, setNames(meta_Alcohol_16_800$seurat_clusters, rownames(meta_Alcohol_16_800)))

soup.channel_Alcohol_16_800  <- setDR(soup.channel_Alcohol_16_800, umap_Alcohol_16_800)
head(meta_Alcohol_16_800)
soup.channel_Alcohol_16_800 <- autoEstCont(soup.channel_Alcohol_16_800)
head(soup.channel_Alcohol_16_800$soupProfile[order(soup.channel_Alcohol_16_800$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_16_800 = adjustCounts(soup.channel_Alcohol_16_800)

#Sample 56
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_17_810")
filt.matrix_Alcohol_17_810<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_17_810<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_17_810)
str(filt.matrix_Alcohol_17_810)
srat_Alcohol_17_810<-CreateSeuratObject(counts=filt.matrix_Alcohol_17_810)
Alcohol_17_810
soup.channel_Alcohol_17_810<-SoupChannel(raw.matrix_Alcohol_17_810, filt.matrix_Alcohol_17_810)
soup.channel_Alcohol_17_810
srat_Alcohol_17_810 <- NormalizeData(srat_Alcohol_17_810, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_17_810 <- FindVariableFeatures(srat_Alcohol_17_810, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_17_810 <- ScaleData(srat_Alcohol_17_810)
srat_Alcohol_17_810 <- RunPCA(srat_Alcohol_17_810, verbose = F)
srat_Alcohol_17_810 <- RunUMAP(srat_Alcohol_17_810, dims = 1:15, verbose = F)
srat_Alcohol_17_810 <- FindNeighbors(srat_Alcohol_17_810, dims = 1:15, verbose = F)
srat_Alcohol_17_810 <- FindClusters(srat_Alcohol_17_810, verbose = T)

meta_Alcohol_17_810    <- srat_Alcohol_17_810@meta.data
umap_Alcohol_17_810    <- srat_Alcohol_17_810@reductions$umap@cell.embeddings
soup.channel_Alcohol_17_810  <- setClusters(soup.channel_Alcohol_17_810, setNames(meta_Alcohol_17_810$seurat_clusters, rownames(meta_Alcohol_17_810)))

soup.channel_Alcohol_17_810  <- setDR(soup.channel_Alcohol_17_810, umap_Alcohol_17_810)
head(meta_Alcohol_17_810)
soup.channel_Alcohol_17_810 <- autoEstCont(soup.channel_Alcohol_17_810)
head(soup.channel_Alcohol_17_810$soupProfile[order(soup.channel_Alcohol_17_810$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_17_810 = adjustCounts(soup.channel_Alcohol_17_810)

#Sample 57
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_18_813")
filt.matrix_Alcohol_18_813<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_18_813<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_18_813)
str(filt.matrix_Alcohol_18_813)
srat_Alcohol_18_813<-CreateSeuratObject(counts=filt.matrix_Alcohol_18_813)
Alcohol_18_813
soup.channel_Alcohol_18_813<-SoupChannel(raw.matrix_Alcohol_18_813, filt.matrix_Alcohol_18_813)
soup.channel_Alcohol_18_813
srat_Alcohol_18_813 <- NormalizeData(srat_Alcohol_18_813, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_18_813 <- FindVariableFeatures(srat_Alcohol_18_813, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_18_813 <- ScaleData(srat_Alcohol_18_813)
srat_Alcohol_18_813 <- RunPCA(srat_Alcohol_18_813, verbose = F)
srat_Alcohol_18_813 <- RunUMAP(srat_Alcohol_18_813, dims = 1:15, verbose = F)
srat_Alcohol_18_813 <- FindNeighbors(srat_Alcohol_18_813, dims = 1:15, verbose = F)
srat_Alcohol_18_813 <- FindClusters(srat_Alcohol_18_813, verbose = T)

meta_Alcohol_18_813    <- srat_Alcohol_18_813@meta.data
umap_Alcohol_18_813    <- srat_Alcohol_18_813@reductions$umap@cell.embeddings
soup.channel_Alcohol_18_813  <- setClusters(soup.channel_Alcohol_18_813, setNames(meta_Alcohol_18_813$seurat_clusters, rownames(meta_Alcohol_18_813)))

soup.channel_Alcohol_18_813  <- setDR(soup.channel_Alcohol_18_813, umap_Alcohol_18_813)
head(meta_Alcohol_18_813)
soup.channel_Alcohol_18_813 <- autoEstCont(soup.channel_Alcohol_18_813)
head(soup.channel_Alcohol_18_813$soupProfile[order(soup.channel_Alcohol_18_813$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_18_813 = adjustCounts(soup.channel_Alcohol_18_813)

#Sample 58
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_19_833")
filt.matrix_Alcohol_19_833<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_19_833<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_19_833)
str(filt.matrix_Alcohol_19_833)
srat_Alcohol_19_833<-CreateSeuratObject(counts=filt.matrix_Alcohol_19_833)
Alcohol_19_833
soup.channel_Alcohol_19_833<-SoupChannel(raw.matrix_Alcohol_19_833, filt.matrix_Alcohol_19_833)
soup.channel_Alcohol_19_833
srat_Alcohol_19_833 <- NormalizeData(srat_Alcohol_19_833, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_19_833 <- FindVariableFeatures(srat_Alcohol_19_833, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_19_833 <- ScaleData(srat_Alcohol_19_833)
srat_Alcohol_19_833 <- RunPCA(srat_Alcohol_19_833, verbose = F)
srat_Alcohol_19_833 <- RunUMAP(srat_Alcohol_19_833, dims = 1:15, verbose = F)
srat_Alcohol_19_833 <- FindNeighbors(srat_Alcohol_19_833, dims = 1:15, verbose = F)
srat_Alcohol_19_833 <- FindClusters(srat_Alcohol_19_833, verbose = T)

meta_Alcohol_19_833    <- srat_Alcohol_19_833@meta.data
umap_Alcohol_19_833    <- srat_Alcohol_19_833@reductions$umap@cell.embeddings
soup.channel_Alcohol_19_833  <- setClusters(soup.channel_Alcohol_19_833, setNames(meta_Alcohol_19_833$seurat_clusters, rownames(meta_Alcohol_19_833)))

soup.channel_Alcohol_19_833  <- setDR(soup.channel_Alcohol_19_833, umap_Alcohol_19_833)
head(meta_Alcohol_19_833)
soup.channel_Alcohol_19_833 <- autoEstCont(soup.channel_Alcohol_19_833)
head(soup.channel_Alcohol_19_833$soupProfile[order(soup.channel_Alcohol_19_833$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_19_833 = adjustCounts(soup.channel_Alcohol_19_833)

#Sample 59
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_21_850")
filt.matrix_Alcohol_21_850<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_21_850<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_21_850)
str(filt.matrix_Alcohol_21_850)
srat_Alcohol_21_850<-CreateSeuratObject(counts=filt.matrix_Alcohol_21_850)
Alcohol_21_850
soup.channel_Alcohol_21_850<-SoupChannel(raw.matrix_Alcohol_21_850, filt.matrix_Alcohol_21_850)
soup.channel_Alcohol_21_850
srat_Alcohol_21_850 <- NormalizeData(srat_Alcohol_21_850, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_21_850 <- FindVariableFeatures(srat_Alcohol_21_850, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_21_850 <- ScaleData(srat_Alcohol_21_850)
srat_Alcohol_21_850 <- RunPCA(srat_Alcohol_21_850, verbose = F)
srat_Alcohol_21_850 <- RunUMAP(srat_Alcohol_21_850, dims = 1:15, verbose = F)
srat_Alcohol_21_850 <- FindNeighbors(srat_Alcohol_21_850, dims = 1:15, verbose = F)
srat_Alcohol_21_850 <- FindClusters(srat_Alcohol_21_850, verbose = T)

meta_Alcohol_21_850    <- srat_Alcohol_21_850@meta.data
umap_Alcohol_21_850    <- srat_Alcohol_21_850@reductions$umap@cell.embeddings
soup.channel_Alcohol_21_850  <- setClusters(soup.channel_Alcohol_21_850, setNames(meta_Alcohol_21_850$seurat_clusters, rownames(meta_Alcohol_21_850)))

soup.channel_Alcohol_21_850  <- setDR(soup.channel_Alcohol_21_850, umap_Alcohol_21_850)
head(meta_Alcohol_21_850)
soup.channel_Alcohol_21_850 <- autoEstCont(soup.channel_Alcohol_21_850)
head(soup.channel_Alcohol_21_850$soupProfile[order(soup.channel_Alcohol_21_850$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_21_850 = adjustCounts(soup.channel_Alcohol_21_850)

#Sample 60
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Alcohol_24_861")
filt.matrix_Alcohol_24_861<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Alcohol_24_861<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Alcohol_24_861)
str(filt.matrix_Alcohol_24_861)
srat_Alcohol_24_861<-CreateSeuratObject(counts=filt.matrix_Alcohol_24_861)
Alcohol_24_861
soup.channel_Alcohol_24_861<-SoupChannel(raw.matrix_Alcohol_24_861, filt.matrix_Alcohol_24_861)
soup.channel_Alcohol_24_861
srat_Alcohol_24_861 <- NormalizeData(srat_Alcohol_24_861, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Alcohol_24_861 <- FindVariableFeatures(srat_Alcohol_24_861, selection.method = "vst", nfeatures = 2000)
srat_Alcohol_24_861 <- ScaleData(srat_Alcohol_24_861)
srat_Alcohol_24_861 <- RunPCA(srat_Alcohol_24_861, verbose = F)
srat_Alcohol_24_861 <- RunUMAP(srat_Alcohol_24_861, dims = 1:15, verbose = F)
srat_Alcohol_24_861 <- FindNeighbors(srat_Alcohol_24_861, dims = 1:15, verbose = F)
srat_Alcohol_24_861 <- FindClusters(srat_Alcohol_24_861, verbose = T)

meta_Alcohol_24_861    <- srat_Alcohol_24_861@meta.data
umap_Alcohol_24_861    <- srat_Alcohol_24_861@reductions$umap@cell.embeddings
soup.channel_Alcohol_24_861  <- setClusters(soup.channel_Alcohol_24_861, setNames(meta_Alcohol_24_861$seurat_clusters, rownames(meta_Alcohol_24_861)))

soup.channel_Alcohol_24_861  <- setDR(soup.channel_Alcohol_24_861, umap_Alcohol_24_861)
head(meta_Alcohol_24_861)
soup.channel_Alcohol_24_861 <- autoEstCont(soup.channel_Alcohol_24_861)
head(soup.channel_Alcohol_24_861$soupProfile[order(soup.channel_Alcohol_24_861$soupProfile$est, decreasing = T), ], n = 20)

out_Alcohol_24_861 = adjustCounts(soup.channel_Alcohol_24_861)

#Sample 61
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_02_353")
filt.matrix_Control_02_353<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_02_353<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_02_353)
str(filt.matrix_Control_02_353)
srat_Control_02_353<-CreateSeuratObject(counts=filt.matrix_Control_02_353)
Control_02_353
soup.channel_Control_02_353<-SoupChannel(raw.matrix_Control_02_353, filt.matrix_Control_02_353)
soup.channel_Control_02_353
srat_Control_02_353 <- NormalizeData(srat_Control_02_353, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_02_353 <- FindVariableFeatures(srat_Control_02_353, selection.method = "vst", nfeatures = 2000)
srat_Control_02_353 <- ScaleData(srat_Control_02_353)
srat_Control_02_353 <- RunPCA(srat_Control_02_353, verbose = F)
srat_Control_02_353 <- RunUMAP(srat_Control_02_353, dims = 1:15, verbose = F)
srat_Control_02_353 <- FindNeighbors(srat_Control_02_353, dims = 1:15, verbose = F)
srat_Control_02_353 <- FindClusters(srat_Control_02_353, verbose = T)

meta_Control_02_353    <- srat_Control_02_353@meta.data
umap_Control_02_353    <- srat_Control_02_353@reductions$umap@cell.embeddings
soup.channel_Control_02_353  <- setClusters(soup.channel_Control_02_353, setNames(meta_Control_02_353$seurat_clusters, rownames(meta_Control_02_353)))

soup.channel_Control_02_353  <- setDR(soup.channel_Control_02_353, umap_Control_02_353)
head(meta_Control_02_353)
soup.channel_Control_02_353 <- autoEstCont(soup.channel_Control_02_353)
head(soup.channel_Control_02_353$soupProfile[order(soup.channel_Control_02_353$soupProfile$est, decreasing = T), ], n = 20)

out_Control_02_353 = adjustCounts(soup.channel_Control_02_353)

#Sample 62
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_04_453")
filt.matrix_Control_04_453<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_04_453<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_04_453)
str(filt.matrix_Control_04_453)
srat_Control_04_453<-CreateSeuratObject(counts=filt.matrix_Control_04_453)
Control_04_453
soup.channel_Control_04_453<-SoupChannel(raw.matrix_Control_04_453, filt.matrix_Control_04_453)
soup.channel_Control_04_453
srat_Control_04_453<- NormalizeData(srat_Control_04_453, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_04_453<- FindVariableFeatures(srat_Control_04_453, selection.method = "vst", nfeatures = 2000)
srat_Control_04_453<- ScaleData(srat_Control_04_453)
srat_Control_04_453<- RunPCA(srat_Control_04_453, verbose = F)
srat_Control_04_453<- RunUMAP(srat_Control_04_453, dims = 1:15, verbose = F)
srat_Control_04_453<- FindNeighbors(srat_Control_04_453, dims = 1:15, verbose = F)
srat_Control_04_453<- FindClusters(srat_Control_04_453, verbose = T)

meta_Control_04_453<- srat_Control_04_453@meta.data
umap_Control_04_453<- srat_Control_04_453@reductions$umap@cell.embeddings
soup.channel_Control_04_453  <- setClusters(soup.channel_Control_04_453, setNames(meta_Control_04_453$seurat_clusters, rownames(meta_Control_04_453)))

soup.channel_Control_04_453<- setDR(soup.channel_Control_04_453, umap_Control_04_453)
head(meta_Control_04_453)
soup.channel_Control_04_453<- autoEstCont(soup.channel_Control_04_453)
head(soup.channel_Control_04_453$soupProfile[order(soup.channel_Control_04_453$soupProfile$est, decreasing = T), ], n = 20)

out_Control_04_453 = adjustCounts(soup.channel_Control_04_453)

#Sample 63
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_05_469")
filt.matrix_Control_05_469<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_05_469<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_05_469)
str(filt.matrix_Control_05_469)
srat_Control_05_469<-CreateSeuratObject(counts=filt.matrix_Control_05_469)
Control_05_469
soup.channel_Control_05_469<-SoupChannel(raw.matrix_Control_05_469, filt.matrix_Control_05_469)
soup.channel_Control_05_469
srat_Control_05_469<- NormalizeData(srat_Control_05_469, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_05_469<- FindVariableFeatures(srat_Control_05_469, selection.method = "vst", nfeatures = 2000)
srat_Control_05_469<- ScaleData(srat_Control_05_469)
srat_Control_05_469<- RunPCA(srat_Control_05_469, verbose = F)
srat_Control_05_469<- RunUMAP(srat_Control_05_469, dims = 1:15, verbose = F)
srat_Control_05_469<- FindNeighbors(srat_Control_05_469, dims = 1:15, verbose = F)
srat_Control_05_469<- FindClusters(srat_Control_05_469, verbose = T)

meta_Control_05_469<- srat_Control_05_469@meta.data
umap_Control_05_469<- srat_Control_05_469@reductions$umap@cell.embeddings
soup.channel_Control_05_469  <- setClusters(soup.channel_Control_05_469, setNames(meta_Control_05_469$seurat_clusters, rownames(meta_Control_05_469)))

soup.channel_Control_05_469<- setDR(soup.channel_Control_05_469, umap_Control_05_469)
head(meta_Control_05_469)
soup.channel_Control_05_469<- autoEstCont(soup.channel_Control_05_469)
head(soup.channel_Control_05_469$soupProfile[order(soup.channel_Control_05_469$soupProfile$est, decreasing = T), ], n = 20)

out_Control_05_469 = adjustCounts(soup.channel_Control_05_469)

#Sample 64
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_06_498")
filt.matrix_Control_06_498<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_06_498<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_06_498)
str(filt.matrix_Control_06_498)
srat_Control_06_498<-CreateSeuratObject(counts=filt.matrix_Control_06_498)
Control_06_498
soup.channel_Control_06_498<-SoupChannel(raw.matrix_Control_06_498, filt.matrix_Control_06_498)
soup.channel_Control_06_498
srat_Control_06_498<- NormalizeData(srat_Control_06_498, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_06_498<- FindVariableFeatures(srat_Control_06_498, selection.method = "vst", nfeatures = 2000)
srat_Control_06_498<- ScaleData(srat_Control_06_498)
srat_Control_06_498<- RunPCA(srat_Control_06_498, verbose = F)
srat_Control_06_498<- RunUMAP(srat_Control_06_498, dims = 1:15, verbose = F)
srat_Control_06_498<- FindNeighbors(srat_Control_06_498, dims = 1:15, verbose = F)
srat_Control_06_498<- FindClusters(srat_Control_06_498, verbose = T)

meta_Control_06_498<- srat_Control_06_498@meta.data
umap_Control_06_498<- srat_Control_06_498@reductions$umap@cell.embeddings
soup.channel_Control_06_498  <- setClusters(soup.channel_Control_06_498, setNames(meta_Control_06_498$seurat_clusters, rownames(meta_Control_06_498)))

soup.channel_Control_06_498<- setDR(soup.channel_Control_06_498, umap_Control_06_498)
head(meta_Control_06_498)
soup.channel_Control_06_498<- autoEstCont(soup.channel_Control_06_498)
head(soup.channel_Control_06_498$soupProfile[order(soup.channel_Control_06_498$soupProfile$est, decreasing = T), ], n = 20)

out_Control_06_498 = adjustCounts(soup.channel_Control_06_498)

#Sample 65
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_08_644")
filt.matrix_Control_08_644<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_08_644<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_08_644)
str(filt.matrix_Control_08_644)
srat_Control_08_644<-CreateSeuratObject(counts=filt.matrix_Control_08_644)
Control_08_644
soup.channel_Control_08_644<-SoupChannel(raw.matrix_Control_08_644, filt.matrix_Control_08_644)
soup.channel_Control_08_644
srat_Control_08_644<- NormalizeData(srat_Control_08_644, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_08_644<- FindVariableFeatures(srat_Control_08_644, selection.method = "vst", nfeatures = 2000)
srat_Control_08_644<- ScaleData(srat_Control_08_644)
srat_Control_08_644<- RunPCA(srat_Control_08_644, verbose = F)
srat_Control_08_644<- RunUMAP(srat_Control_08_644, dims = 1:15, verbose = F)
srat_Control_08_644<- FindNeighbors(srat_Control_08_644, dims = 1:15, verbose = F)
srat_Control_08_644<- FindClusters(srat_Control_08_644, verbose = T)

meta_Control_08_644<- srat_Control_08_644@meta.data
umap_Control_08_644<- srat_Control_08_644@reductions$umap@cell.embeddings
soup.channel_Control_08_644  <- setClusters(soup.channel_Control_08_644, setNames(meta_Control_08_644$seurat_clusters, rownames(meta_Control_08_644)))

soup.channel_Control_08_644<- setDR(soup.channel_Control_08_644, umap_Control_08_644)
head(meta_Control_08_644)
soup.channel_Control_08_644<- autoEstCont(soup.channel_Control_08_644)
head(soup.channel_Control_08_644$soupProfile[order(soup.channel_Control_08_644$soupProfile$est, decreasing = T), ], n = 20)

out_Control_08_644 = adjustCounts(soup.channel_Control_08_644)

#Sample 66
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_09_647")
filt.matrix_Control_09_647<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_09_647<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_09_647)
str(filt.matrix_Control_09_647)
srat_Control_09_647<-CreateSeuratObject(counts=filt.matrix_Control_09_647)
Control_09_647
soup.channel_Control_09_647<-SoupChannel(raw.matrix_Control_09_647, filt.matrix_Control_09_647)
soup.channel_Control_09_647
srat_Control_09_647<- NormalizeData(srat_Control_09_647, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_09_647<- FindVariableFeatures(srat_Control_09_647, selection.method = "vst", nfeatures = 2000)
srat_Control_09_647<- ScaleData(srat_Control_09_647)
srat_Control_09_647<- RunPCA(srat_Control_09_647, verbose = F)
srat_Control_09_647<- RunUMAP(srat_Control_09_647, dims = 1:15, verbose = F)
srat_Control_09_647<- FindNeighbors(srat_Control_09_647, dims = 1:15, verbose = F)
srat_Control_09_647<- FindClusters(srat_Control_09_647, verbose = T)

meta_Control_09_647<- srat_Control_09_647@meta.data
umap_Control_09_647<- srat_Control_09_647@reductions$umap@cell.embeddings
soup.channel_Control_09_647  <- setClusters(soup.channel_Control_09_647, setNames(meta_Control_09_647$seurat_clusters, rownames(meta_Control_09_647)))

soup.channel_Control_09_647<- setDR(soup.channel_Control_09_647, umap_Control_09_647)
head(meta_Control_09_647)
soup.channel_Control_09_647<- autoEstCont(soup.channel_Control_09_647)
head(soup.channel_Control_09_647$soupProfile[order(soup.channel_Control_09_647$soupProfile$est, decreasing = T), ], n = 20)

out_Control_09_647 = adjustCounts(soup.channel_Control_09_647)

#Sample 67
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_11_692")
filt.matrix_Control_11_692<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_11_692<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_11_692)
str(filt.matrix_Control_11_692)
srat_Control_11_692<-CreateSeuratObject(counts=filt.matrix_Control_11_692)
Control_11_692
soup.channel_Control_11_692<-SoupChannel(raw.matrix_Control_11_692, filt.matrix_Control_11_692)
soup.channel_Control_11_692
srat_Control_11_692<- NormalizeData(srat_Control_11_692, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_11_692<- FindVariableFeatures(srat_Control_11_692, selection.method = "vst", nfeatures = 2000)
srat_Control_11_692<- ScaleData(srat_Control_11_692)
srat_Control_11_692<- RunPCA(srat_Control_11_692, verbose = F)
srat_Control_11_692<- RunUMAP(srat_Control_11_692, dims = 1:15, verbose = F)
srat_Control_11_692<- FindNeighbors(srat_Control_11_692, dims = 1:15, verbose = F)
srat_Control_11_692<- FindClusters(srat_Control_11_692, verbose = T)

meta_Control_11_692<- srat_Control_11_692@meta.data
umap_Control_11_692<- srat_Control_11_692@reductions$umap@cell.embeddings
soup.channel_Control_11_692  <- setClusters(soup.channel_Control_11_692, setNames(meta_Control_11_692$seurat_clusters, rownames(meta_Control_11_692)))

soup.channel_Control_11_692<- setDR(soup.channel_Control_11_692, umap_Control_11_692)
head(meta_Control_11_692)
soup.channel_Control_11_692<- autoEstCont(soup.channel_Control_11_692)
head(soup.channel_Control_11_692$soupProfile[order(soup.channel_Control_11_692$soupProfile$est, decreasing = T), ], n = 20)

out_Control_11_692 = adjustCounts(soup.channel_Control_11_692)

#Sample 68
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_13_734")
filt.matrix_Control_13_734<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_13_734<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_13_734)
str(filt.matrix_Control_13_734)
srat_Control_13_734<-CreateSeuratObject(counts=filt.matrix_Control_13_734)
Control_13_734
soup.channel_Control_13_734<-SoupChannel(raw.matrix_Control_13_734, filt.matrix_Control_13_734)
soup.channel_Control_13_734
srat_Control_13_734<- NormalizeData(srat_Control_13_734, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_13_734<- FindVariableFeatures(srat_Control_13_734, selection.method = "vst", nfeatures = 2000)
srat_Control_13_734<- ScaleData(srat_Control_13_734)
srat_Control_13_734<- RunPCA(srat_Control_13_734, verbose = F)
srat_Control_13_734<- RunUMAP(srat_Control_13_734, dims = 1:15, verbose = F)
srat_Control_13_734<- FindNeighbors(srat_Control_13_734, dims = 1:15, verbose = F)
srat_Control_13_734<- FindClusters(srat_Control_13_734, verbose = T)

meta_Control_13_734<- srat_Control_13_734@meta.data
umap_Control_13_734<- srat_Control_13_734@reductions$umap@cell.embeddings
soup.channel_Control_13_734  <- setClusters(soup.channel_Control_13_734, setNames(meta_Control_13_734$seurat_clusters, rownames(meta_Control_13_734)))

soup.channel_Control_13_734<- setDR(soup.channel_Control_13_734, umap_Control_13_734)
head(meta_Control_13_734)
soup.channel_Control_13_734<- autoEstCont(soup.channel_Control_13_734)
head(soup.channel_Control_13_734$soupProfile[order(soup.channel_Control_13_734$soupProfile$est, decreasing = T), ], n = 20)

out_Control_13_734 = adjustCounts(soup.channel_Control_13_734)

#Sample 69
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_16_770")
filt.matrix_Control_16_770<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_16_770<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_16_770)
str(filt.matrix_Control_16_770)
srat_Control_16_770<-CreateSeuratObject(counts=filt.matrix_Control_16_770)
Control_16_770
soup.channel_Control_16_770<-SoupChannel(raw.matrix_Control_16_770, filt.matrix_Control_16_770)
soup.channel_Control_16_770
srat_Control_16_770<- NormalizeData(srat_Control_16_770, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_16_770<- FindVariableFeatures(srat_Control_16_770, selection.method = "vst", nfeatures = 2000)
srat_Control_16_770<- ScaleData(srat_Control_16_770)
srat_Control_16_770<- RunPCA(srat_Control_16_770, verbose = F)
srat_Control_16_770<- RunUMAP(srat_Control_16_770, dims = 1:15, verbose = F)
srat_Control_16_770<- FindNeighbors(srat_Control_16_770, dims = 1:15, verbose = F)
srat_Control_16_770<- FindClusters(srat_Control_16_770, verbose = T)

meta_Control_16_770<- srat_Control_16_770@meta.data
umap_Control_16_770<- srat_Control_16_770@reductions$umap@cell.embeddings
soup.channel_Control_16_770  <- setClusters(soup.channel_Control_16_770, setNames(meta_Control_16_770$seurat_clusters, rownames(meta_Control_16_770)))

soup.channel_Control_16_770<- setDR(soup.channel_Control_16_770, umap_Control_16_770)
head(meta_Control_16_770)
soup.channel_Control_16_770<- autoEstCont(soup.channel_Control_16_770)
head(soup.channel_Control_16_770$soupProfile[order(soup.channel_Control_16_770$soupProfile$est, decreasing = T), ], n = 20)

out_Control_16_770 = adjustCounts(soup.channel_Control_16_770)

#Sample 70
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_18_793")
filt.matrix_Control_18_793<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_18_793<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_18_793)
str(filt.matrix_Control_18_793)
srat_Control_18_793<-CreateSeuratObject(counts=filt.matrix_Control_18_793)
Control_18_793
soup.channel_Control_18_793<-SoupChannel(raw.matrix_Control_18_793, filt.matrix_Control_18_793)
soup.channel_Control_18_793
srat_Control_18_793<- NormalizeData(srat_Control_18_793, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_18_793<- FindVariableFeatures(srat_Control_18_793, selection.method = "vst", nfeatures = 2000)
srat_Control_18_793<- ScaleData(srat_Control_18_793)
srat_Control_18_793<- RunPCA(srat_Control_18_793, verbose = F)
srat_Control_18_793<- RunUMAP(srat_Control_18_793, dims = 1:15, verbose = F)
srat_Control_18_793<- FindNeighbors(srat_Control_18_793, dims = 1:15, verbose = F)
srat_Control_18_793<- FindClusters(srat_Control_18_793, verbose = T)

meta_Control_18_793<- srat_Control_18_793@meta.data
umap_Control_18_793<- srat_Control_18_793@reductions$umap@cell.embeddings
soup.channel_Control_18_793  <- setClusters(soup.channel_Control_18_793, setNames(meta_Control_18_793$seurat_clusters, rownames(meta_Control_18_793)))

soup.channel_Control_18_793<- setDR(soup.channel_Control_18_793, umap_Control_18_793)
head(meta_Control_18_793)
soup.channel_Control_18_793<- autoEstCont(soup.channel_Control_18_793)
head(soup.channel_Control_18_793$soupProfile[order(soup.channel_Control_18_793$soupProfile$est, decreasing = T), ], n = 20)

out_Control_18_793 = adjustCounts(soup.channel_Control_18_793)

#Sample 71
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_19_811")
filt.matrix_Control_19_811<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_19_811<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_19_811)
str(filt.matrix_Control_19_811)
srat_Control_19_811<-CreateSeuratObject(counts=filt.matrix_Control_19_811)
Control_19_811
soup.channel_Control_19_811<-SoupChannel(raw.matrix_Control_19_811, filt.matrix_Control_19_811)
soup.channel_Control_19_811
srat_Control_19_811<- NormalizeData(srat_Control_19_811, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_19_811<- FindVariableFeatures(srat_Control_19_811, selection.method = "vst", nfeatures = 2000)
srat_Control_19_811<- ScaleData(srat_Control_19_811)
srat_Control_19_811<- RunPCA(srat_Control_19_811, verbose = F)
srat_Control_19_811<- RunUMAP(srat_Control_19_811, dims = 1:15, verbose = F)
srat_Control_19_811<- FindNeighbors(srat_Control_19_811, dims = 1:15, verbose = F)
srat_Control_19_811<- FindClusters(srat_Control_19_811, verbose = T)

meta_Control_19_811<- srat_Control_19_811@meta.data
umap_Control_19_811<- srat_Control_19_811@reductions$umap@cell.embeddings
soup.channel_Control_19_811  <- setClusters(soup.channel_Control_19_811, setNames(meta_Control_19_811$seurat_clusters, rownames(meta_Control_19_811)))

soup.channel_Control_19_811<- setDR(soup.channel_Control_19_811, umap_Control_19_811)
head(meta_Control_19_811)
soup.channel_Control_19_811<- autoEstCont(soup.channel_Control_19_811)
head(soup.channel_Control_19_811$soupProfile[order(soup.channel_Control_19_811$soupProfile$est, decreasing = T), ], n = 20)

out_Control_19_811 = adjustCounts(soup.channel_Control_19_811)

#Sample 72
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/Control_20_830")
filt.matrix_Control_20_830<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_Control_20_830<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_Control_20_830)
str(filt.matrix_Control_20_830)
srat_Control_20_830<-CreateSeuratObject(counts=filt.matrix_Control_20_830)

Control_20_830
soup.channel_Control_20_830<-SoupChannel(raw.matrix_Control_20_830, filt.matrix_Control_20_830)
soup.channel_Control_20_830
srat_Control_20_830<- NormalizeData(srat_Control_20_830, normalization.method = "LogNormalize", scale.factor = 10000)

srat_Control_20_830<- FindVariableFeatures(srat_Control_20_830, selection.method = "vst", nfeatures = 2000)
srat_Control_20_830<- ScaleData(srat_Control_20_830)
srat_Control_20_830<- RunPCA(srat_Control_20_830, verbose = F)
srat_Control_20_830<- RunUMAP(srat_Control_20_830, dims = 1:15, verbose = F)
srat_Control_20_830<- FindNeighbors(srat_Control_20_830, dims = 1:15, verbose = F)
srat_Control_20_830<- FindClusters(srat_Control_20_830, verbose = T)

meta_Control_20_830<- srat_Control_20_830@meta.data
umap_Control_20_830<- srat_Control_20_830@reductions$umap@cell.embeddings
soup.channel_Control_20_830  <- setClusters(soup.channel_Control_20_830, setNames(meta_Control_20_830$seurat_clusters, rownames(meta_Control_20_830)))

soup.channel_Control_20_830<- setDR(soup.channel_Control_20_830, umap_Control_20_830)
head(meta_Control_20_830)
soup.channel_Control_20_830<- autoEstCont(soup.channel_Control_20_830)
head(soup.channel_Control_20_830$soupProfile[order(soup.channel_Control_20_830$soupProfile$est, decreasing = T), ], n = 20)

out_Control_20_830 = adjustCounts(soup.channel_Control_20_830)
#Sample 73
setwd("/path/to/file/human_dPFC_snRNAseq_2022/human_dPFC_snRNAseq_2022/outs_files/983_GEX_Sample_295")
filt.matrix_983_GEX_Sample_295<-Read10X_h5("filtered_feature_bc_matrix.h5", use.names=T)
raw.matrix_983_GEX_Sample_295<-Read10X_h5("raw_feature_bc_matrix.h5", use.names=T)
str(raw.matrix_983_GEX_Sample_295)
str(filt.matrix_983_GEX_Sample_295)
srat_983_GEX_Sample_295<-CreateSeuratObject(counts=filt.matrix_983_GEX_Sample_295)
983_GEX_Sample_295
soup.channel_983_GEX_Sample_295<-SoupChannel(raw.matrix_983_GEX_Sample_295, filt.matrix_983_GEX_Sample_295)
soup.channel_983_GEX_Sample_295
srat_983_GEX_Sample_295<- NormalizeData(srat_983_GEX_Sample_295, normalization.method = "LogNormalize", scale.factor = 10000)

srat_983_GEX_Sample_295<- FindVariableFeatures(srat_983_GEX_Sample_295, selection.method = "vst", nfeatures = 2000)
srat_983_GEX_Sample_295<- ScaleData(srat_983_GEX_Sample_295)
srat_983_GEX_Sample_295<- RunPCA(srat_983_GEX_Sample_295, verbose = F)
srat_983_GEX_Sample_295<- RunUMAP(srat_983_GEX_Sample_295, dims = 1:15, verbose = F)
srat_983_GEX_Sample_295<- FindNeighbors(srat_983_GEX_Sample_295, dims = 1:15, verbose = F)
srat_983_GEX_Sample_295<- FindClusters(srat_983_GEX_Sample_295, verbose = T)

meta_983_GEX_Sample_295<- srat_983_GEX_Sample_295@meta.data
umap_983_GEX_Sample_295<- srat_983_GEX_Sample_295@reductions$umap@cell.embeddings
soup.channel_983_GEX_Sample_295  <- setClusters(soup.channel_983_GEX_Sample_295, setNames(meta_983_GEX_Sample_295$seurat_clusters, rownames(meta_983_GEX_Sample_295)))

soup.channel_983_GEX_Sample_295<- setDR(soup.channel_983_GEX_Sample_295, umap_983_GEX_Sample_295)
head(meta_983_GEX_Sample_295)
soup.channel_983_GEX_Sample_295<- autoEstCont(soup.channel_983_GEX_Sample_295)
head(soup.channel_983_GEX_Sample_295$soupProfile[order(soup.channel_983_GEX_Sample_295$soupProfile$est, decreasing = T), ], n = 20)

out_983_GEX_Sample_295 = adjustCounts(soup.channel_983_GEX_Sample_295)

##Now make one big count matrix
library(Seurat)
scs=list(sc_303=out_1000_GEX_Sample_303, sc_351=out_1002_GEX_Sample_351, sc_366=out_1003_GEX_Sample_366, sc_586=out_1155_GEX_Sample_586,sc_339=out_1156_GEX_Sample_339, sc_236=out_1157_GEX_Sample_236, sc_278=out_1158_GEX_Sample_278, sc_642=out_1159_GEX_Sample_642, sc_723=out_1160_GEX_Sample_723, sc_401=out_1161_GEX_Sample_401, sc_591=out_575, sc_212=out_893_3GEX_Sample_813_nuclei, sc_225=out_894_3GEX_Sample_814_nuclei, sc_218=out_895_3GEX_Sample_821_nuclei, sc_256=out_896_3GEX_Sample_825_nuclei, sc_402=out_898_3GEX_Sample_6992_nuclei, sc_337=out_899_3GEX_Sample_6996_nuclei, sc_285=out_900_3GEX_Sample_7000_nuclei, sc_570=out_919_3GEX_Sample_6979_nuclei, sc_551=out_920_3GEX_Sample_6980_nuclei, sc_410=out_921_3GEX_Sample_6984_nuclei, sc_571=out_922_3GEX_Sample_6986_nuclei, sc_567=out_923_3GEX_Sample_6987_nuclei, sc_522=out_924_3GEX_Sample_6988_nuclei, sc_512=out_925_3GEX_Sample_6989_nuclei, sc_620=out_938_3GEX_Sample_620_nuclei, sc_663=out_940_3GEX_Sample_663C_nuclei, sc_635=out_942_3GEX_Sample_635_nuclei, sc_646=out_943_3GEX_Sample_646_nuclei, sc_650=out_944_3GEX_Sample_650_nuclei, sc_693=out_945_3GEX_Sample_693_nuclei, sc_180=out_947_GEX_Sample_180, sc_656=out_948_GEX_Sample_656, sc_688=out_949_GEX_Sample_688, sc_700=out_950_GEX_Sample_700, sc_97=out_951_GEX_Sample_97, sc_182=out_952_GEX_Sample_182, sc_243=out_953_GEX_Sample_243, sc_727=out_954_GEX_Sample_727, sc_192=out_980_GEX_Sample_192, sc_228=out_981_GEX_Sample_228, sc_209=out_984_GEX_Sample_209, sc_234=out_985_GEX_Sample_234, sc_252=out_986_GEX_Sample_252, sc_253=out_987_GEX_Sample_253, sc_315=out_996_GEX_Sample_315, sc_330=out_997_GEX_Sample_330, sc_332=out_998_GEX_Sample_332, sc_286=out_Alcohol_01_286, sc_508=out_Alcohol_02_508, sc_652=out_Alcohol_05_652, sc_695=out_Alcohol_06_695, sc_767=out_Alcohol_11_767, sc_800=out_Alcohol_16_800, sc_810=out_Alcohol_17_810, sc_813=out_Alcohol_18_813, sc_833=out_Alcohol_19_833, sc_850=out_Alcohol_21_850, sc_861=out_Alcohol_24_861, sc_353=out_Control_02_353, sc_453=out_Control_04_453, sc_469=out_Control_05_469, sc_498=out_Control_06_498, sc_644=out_Control_08_644, sc_647=out_Control_09_647, sc_692=out_Control_11_692, sc_734=out_Control_13_734, sc_770=out_Control_16_770, sc_793=out_Control_18_793, sc_811=out_Control_19_811, sc_830=out_Control_20_830, sc_295=out_983_GEX_Sample_295, sc_367=out_999_GEX_Sample_367)

srat<-list()
for(nom in names(scs)){
  #Clean channel named 'nom'
  #tmp = adjustCounts(scs[[nom]])
  #already adjusted 
  tmp<-scs[[nom]]
  #Add experiment name to cell barcodes to make them unique
  colnames(tmp) = paste0(nom,'_',colnames(tmp))
  #Store the result
  srat[[nom]] = tmp
}

#Combine all count matricies into one matrix
srat = do.call(cbind,srat)
cleaned_all = CreateSeuratObject(srat)
cleaned_all [["percent.mt"]] <- PercentageFeatureSet(cleaned_all , pattern = "^MT-")
meta_clean<-cleaned_all@meta.data
meta_clean$Barcode <- as.factor(rownames(meta_clean))

meta_clean_split<-meta_clean %>%
+     separate(Barcode, c("sc", "SU_number", "barcode"), "_")

#How to remove a column 
meta_clean_split<-select(meta_clean_split, -sc)
meta_clean_split<-select(meta_clean_split, -orig.ident)

cleaned_all_new <- AddMetaData(
   object = cleaned_all,
    metadata = meta_clean_split, )

View(cleaned_all_new@meta.data)

#How to round nCount which is many digits 
cleaned_all_new@meta.data$nCount_RNA<-round(cleaned_all_new@meta.data$nCount_RNA, digits = 0)

meta_pfc_clean<-cleaned_all_new@meta.data
meta_pfc_clean$barcode<-rownames(meta_pfc_clean)
meta_pfc_merged_clean<-merge(meta_pfc_clean,meta_combined,by="SU_number")
rownames(meta_pfc_merged_clean)<-meta_pfc_merged_clean$barcode
pfc_human_clean<- AddMetaData(object = cleaned_all_new, metadata =meta_pfc_merged_clean)

#save the cleaned object and start a clean seurat
save(cleaned_all,file="dPFC_all_samples_cleaned.RData")

